'use strict';!function(require,directRequire){const a=require('react'),b=require('redux'),c=require('moment'),d=require('./a8c87029da0fa06e986298d447ab0fe2.js'),e=require('./cc2c2970ff81ae4a83123e81ee123da2.js'),f=require('./25d0beb4120ce2acafb4e03b95444fda.js'),g=require('./1fcc6bd55b687d154a4247e57fe3011d.js'),h=require('./0794878a22a26634e42df858bbaca543.js'),i=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),j=require('./72410b6d4968336cd8b2fc1d41f52cdf.js'),k=require('./3b5f8e2469c474c8d433c1c6926d8999.js'),l=require('./common/locales/index.js'),m=require('./875171e7b864aa58d026d4fa0999fbd1.js'),{connect:n}=require('react-redux');class o extends a.Component{constructor(a){super(a),this.state={show:a.show,version:'',desc:''}}componentDidMount(){this._cancalLocaleListener=l.onChangeLocale(()=>this.forceUpdate())}componentWillUnmount(){this._cancalLocaleListener()}componentWillReceiveProps(a){a.show!=this.props.show&&this.setState({show:a.show})}onClose(){this.setState({show:!1})}async onConfirm(){if(!this.state.version)return void this.refs.versionInput.focus();try{this.setState({show:!1}),this.props.setProjectQCloud({uploadStatus:i.STATUS.LOADING,currentOperation:j.CLOUD_ACTION_UPLOAD_IDC});const a='PROXY dev-proxy.oa.com:8080'===nw.App.getProxyForURL('https://gz.file.myqcloud.com');this.props.setQCloudWnd({show:!0,status:i.QCLOUD_STATUS.UPLOADING,text:l.config.QCLOUD_WATING_TIP_UPLOADING});const b=await h.uploadSvrCode(this.props.project,{devEnv:this.props.env,cleverPack:!1,src:!0,node_modules:!0,packagejson:!0,env:j.CLOUD_ENV_PRODUCT,version:this.state.version,remark:this.state.desc||this.getPlaceHolder(),onBeforeUpload:(b)=>{if(a){const a=b.pDataLength/1024,c=(a/40).toFixed(0);this.props.setQCloudWnd({show:!0,status:i.QCLOUD_STATUS.UPLOADING,text:l.config.QCLOUD_WATING_TIP_UPLOADING,descList:[l.config.QCLOUD_UPLOAD_WAITING.format(c)],estimateTime:c})}}});this.props.setProjectQCloud({data:b,uploadStatus:i.STATUS.SUCCESS,currentOperation:''}),this.props.setQCloudWnd({show:!0,status:i.QCLOUD_STATUS.UPLOAD_SUCCESS,text:l.config.QCLOUD_UPLOAD_SUCCESS_TITLE,descList:[l.config.QCLOUD_SUCCESS_TIP_UPLOAD.format(c(new Date).calendar())],estimateTime:void 0})}catch(a){this.props.showUploading(i.QCLOUD_STATUS.UPLOAD_FAIL,a.toString()),this.props.setProjectQCloud({uploadStatus:i.STATUS.FAIL,currentOperation:''})}}onAnimationOut(){this.props.close()}onVersionChange(a){let b=a.target.value;b=b.replace(/[^0-9a-zA-Z\.]/g,''),this.setState({version:b})}onInputChange(a){const b=a.currentTarget,c=b.dataset,d=c.name;this.setState({[d]:b.value})}getPlaceHolder(){return l.config.PREVIEW_QR_CODE_TITLE.format([this.props.nickName,c().format('LLL')])}render(){const b=this.props,c='zh'===l.getLocale()?{width:420,marginLeft:-210}:{width:660,marginLeft:-330},d='nodejs'===b.env?'Node.js':'PHP';return a.createElement(m,{show:this.state.show,style:c,inClassName:'ui-animate-pull-down ui-dialog',outClassName:'ui-animate-pull-up ui-dialog',onAnimationOut:this.onAnimationOut.bind(this)},a.createElement('div',{className:'ui-dialog-hd'},a.createElement('h3',{className:'ui-dialog-title'},l.config.CLOUD_ACTION_UPLOAD_IDC,'\uFF08',d,'\uFF09')),a.createElement('div',{className:'ui-dialog-bd'},a.createElement('div',{className:'ui-form'},a.createElement('div',{className:'ui-form-item ui-form-item-inline'},a.createElement('label',{className:'ui-form-label'},l.config.VERSION_NUMBER),a.createElement('div',{className:'ui-form-controls'},a.createElement('div',{className:'ui-input-box'},a.createElement('input',{ref:'versionInput',type:'text',className:'ui-input',maxLength:10,"data-name":'version',value:this.state.version,onChange:this.onVersionChange.bind(this)})),a.createElement('p',{className:'ui-form-tips'},l.config.QCLOUD_SET_VERSION_NUMBER))),a.createElement('div',{className:'ui-form-item ui-form-item-inline'},a.createElement('label',{className:'ui-form-label'},l.config.REMARK),a.createElement('div',{className:'ui-form-controls'},a.createElement('div',{className:'ui-input-box'},a.createElement('input',{type:'text',ref:'descInput',className:'ui-input',value:this.state.desc,maxLength:100,"data-name":'desc',onChange:this.onInputChange.bind(this),placeholder:this.getPlaceHolder()})),a.createElement('p',{className:'ui-form-tips'},l.config.QCLOUD_REMARK_DETAIL))))),a.createElement('div',{className:'ui-dialog-ft'},a.createElement('div',{className:'ui-dialog-action'},a.createElement('button',{className:'ui-button ui-button-default',onClick:this.onClose.bind(this)},l.config.CANCEL),a.createElement('button',{className:'ui-button ui-button-primary',onClick:this.onConfirm.bind(this)},l.config.CONFIRM))))}}module.exports=n((a)=>{const b=a.window.qcloud.uploading&&a.window.qcloud.uploading.descList||[],c=a.project.current;let d='nodejs';try{d=2===parseInt(c.runtimeAttr.qcloud.qcloud_product_info.current_language,10)?'php':'nodejs'}catch(a){}return{env:d,qcloud:c&&c.qcloud,show:a.window.qcloud.uploadIDCShow,nickName:a.user.nickName,project:c,descList:b}},(a)=>({setAutoInstallDependence:(b)=>{a(d.setQCloud({autoInstallDependence:b}))},setQCloudWnd:(b)=>{a(d.setQCloud({uploading:b}))},showUploading:(b=i.QCLOUD_UPLOADING_STATUS.UPLOADING,c='',e='')=>{a(d.setQCloud({uploading:{show:!0,status:b,text:c,estimateTime:e}}))},closeUploading:()=>{a(d.setQCloud({uploading:{show:!1,status:i.QCLOUD_UPLOADING_STATUS.UPLOADING,text:''}}))},close:()=>{a(d.setQCloud({uploadIDCShow:!1}))},setProjectQCloud:(b)=>{a(e.setProjectQCloud(b))},setQCloudActionType:(b,c)=>{a(d.setQCloudActionType({actionType:b,options:c}))},notifyFail:(b)=>a(g.setConfirmInfo({show:!0,showCancel:!1,title:l.config.QCLOUD_UPLOAD_FAIL_TITLE,content:b,callback:async()=>{a(g.setConfirmInfo({show:!1}))}}))}))(o)}(require('lazyload'),require);