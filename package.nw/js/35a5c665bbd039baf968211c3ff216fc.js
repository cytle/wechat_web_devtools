'use strict';!function(require,directRequire){const a=require('./dfd9a72b9ff6078018aa4a64eed949a5.js'),b=require('./5dc59f418d85e854c1a12d402d29e2d7.js'),c=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),d=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js');let e;module.exports={initMusic:function(f){if(e)return;const g=a();e=document.createElement('audio');const h=d.getState();h.toolbar.muted&&(e.muted=!0);const i=global.windowMap.get('MAIN'),j=i.window.document.body;j.appendChild(e),e.addEventListener('play',()=>{f({type:c.SIMULATOR_SET_BACKGROUND_AUDIO,data:{status:b.MUSIC_STATE_PLAY}}),g.triggerOnEvent({eventName:'onMusicPlay',data:{dataUrl:e.src}}),g.triggerOnEvent({eventName:'onBackgroundAudioStateChange',data:{state:'play'}})}),e.addEventListener('pause',()=>{e&&!e.ended&&(!e.error&&f({type:c.SIMULATOR_SET_BACKGROUND_AUDIO,data:{status:b.MUSIC_STATE_PAUSE}}),g.triggerOnEvent({eventName:'onMusicPause',data:{dataUrl:e.src}}),g.triggerOnEvent({eventName:'onBackgroundAudioStateChange',data:{state:'pause'}}))}),e.addEventListener('ended',()=>{e&&(f({type:c.SIMULATOR_SET_BACKGROUND_AUDIO,data:{status:b.MUSIC_STATE_END}}),g.triggerOnEvent({eventName:'onMusicEnd',data:{dataUrl:e.src}}),g.triggerOnEvent({eventName:'onBackgroundAudioStateChange',data:{state:'ended'}}),e.remove(),e=void 0)}),e.addEventListener('waiting',()=>{g.triggerOnEvent({eventName:'onBackgroundAudioStateChange',data:{state:'waiting'}})}),e.addEventListener('canplay',()=>{g.triggerOnEvent({eventName:'onBackgroundAudioStateChange',data:{state:'canplay'}})}),e.addEventListener('error',(a)=>{if(!e)return;f({type:c.SIMULATOR_SET_BACKGROUND_AUDIO,data:{status:b.MUSIC_STATE_ERROR}});const{target:d}=a,{error:h}=d;let i=h.code;i=i===h.MEDIA_ERR_NETWORK?10002:i===h.MEDIA_ERR_DECODE?10003:10001;const j=h.code;g.triggerOnEvent({eventName:'onMusicError',data:{dataUrl:e.src,errMsg:'Error: '+e.error.code}}),g.triggerOnEvent({eventName:'onBackgroundAudioStateChange',data:{state:'error',errMsg:j,errCode:i}}),e.remove(),e=void 0})},playMusic:function(a={}){a.src&&a.src!=e.src?(e.src=a.src,e.play(),e.currentTime=a.startTime||0):e.src&&e.play()},pauseMusic:function(a={}){return!!e&&(e.paused||e.pause(),!0)},resumeMusic:function(a={}){e&&e.paused&&e.play()},stopMusic:function(f={}){if(!e)return!1;const g=a(),h=e.src;return setTimeout(()=>{const a=d.dispatch.bind(d);a({type:c.SIMULATOR_SET_BACKGROUND_AUDIO,data:{status:b.MUSIC_STATE_END}}),g.triggerOnEvent({eventName:'onMusicEnd',data:{dataUrl:h}}),g.triggerOnEvent({eventName:'onBackgroundAudioStateChange',data:{state:'stop'}})}),e.remove(),e=void 0,!0},seekMusic:function(a={}){e&&(e.currentTime=1*a.currentTime,!e.paused&&e.dispatchEvent(new Event('play')))},getAudioBufferd:function(){const a=e?e.buffered:'';if(a){const b=e.currentTime;for(let c=0,d=a.length;c<d;c++){if(a.start(c)<=b&&a.end(c)>=b)return a.end(c)}}return 0},getAudio:function(){return e},removeAudio:function(){e&&(e.remove(),e=void 0)},setMuted:function(a){e&&(e.muted=a)}}}(require('lazyload'),require);