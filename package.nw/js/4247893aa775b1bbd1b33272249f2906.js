;!function(require, directRequire){;"use strict";const tslib_1=require("tslib"),simulatorTypeConfig=require('./efd8b4323f89b2a759d044d894e3a4f0.js'),React=require("react"),utilsTools=require('./84b183688a46c9e2626d3e6f83365e13.js'),toolbarActions=require('./fc137838572a83604db39acff8e909e0.js'),projectActions=require('./cc2c2970ff81ae4a83123e81ee123da2.js'),debugActions=require('./6ff091369f442a4678a2ed4a1f758495.js'),tools=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),DropDown=require('./3c55dff3626a3ee184d599f076158345.js'),vendorManager=require('./d28a711224425b00101635efe1034c99.js'),report=require('./da7c31daaf542cf1796023d8e344b98a.js'),settingsActions=require('./e98c60a262d8d98e69e574a9d12a21df.js'),log=require('./72653d4b93cdd7443296229431a7aa9a.js'),locales=require('./common/locales/index.js');let cpus;const{connect}=require("react-redux"),mapStateToProps=(a)=>{const b=a.info.projectInfo||{},c=a.settings,d=a.project.current,e=d.simulatorType;let f,g=[],h=!1;return e!==simulatorTypeConfig.wechat&&a.plugin.pluginManifests[e]&&a.plugin.pluginManifests[e].libs&&(g=Object.keys(a.plugin.pluginManifests[e].libs)||[],0<g.length&&(h=!0),f=d.simulatorPluginLibVersion[e]),{show:"setting"===b.selected,project:d||{},publicLibUsageRateTotal:a.info.publicLibUsageRate&&a.info.publicLibUsageRate.total||[],compilerSettings:c.compiler||{},pluginManifests:a.plugin.pluginManifests,simulatorPluginLibs:g,simulatorPluginLibVersion:f,showSimulatorPluginLibs:h}},mapDispatchToProps=(a)=>({toggleClickKey:tools.bindActionCreators(toolbarActions.toggleClickKey,a),setProjectSimulatorPluginLibVersion:tools.bindActionCreators(projectActions.setProjectSimulatorPluginLibVersion,a),setProjectSetting:tools.bindActionCreators(projectActions.setProjectSetting,a),setProjectLibVersion:tools.bindActionCreators(projectActions.setProjectLibVersion,a),setProjectScripts:tools.bindActionCreators(projectActions.setProjectScripts,a),openMobileTest:tools.bindActionCreators(debugActions.openMobileTest,a),updateIDESetting:tools.bindActionCreators(settingsActions.updateIDESetting,a)});let ProjectSetting=class extends React.Component{constructor(a){super(a),this.onVendorDownloadStart=(a)=>{const b=this.state.vendorVersionDownloading||[],c=Array.from(new Set([...b,a]));this.setState({vendorVersionDownloading:c,vendorVersionDownloadFailed:!1})},this.onVendorDownloadComplete=(a)=>{const b=this.state.vendorVersionDownloading||[],c=b.findIndex((b)=>b===a);0<=c&&(b.splice(c,1),this.setState({vendorVersionDownloading:[...b]}))},this.onVendorDownloadSuccess=(a)=>{this.onVendorDownloadComplete(a)},this.onVendorDownloadFail=(a)=>{this.onVendorDownloadComplete(a),this.setState({vendorVersionDownloadFailed:!0})},this.onVendorDownloadStatusClick=(a)=>{a.stopPropagation(),this.state.vendorVersionDownloadFailed&&vendorManager.downloadVendorIfNeeded().catch(()=>{})},this.onVendorChange=(a)=>{this.setState({libs:Object.keys(a.libs)})},this.onShowLibs=(a)=>{if(a.stopPropagation(),this.state.showLibs)this.setState({showLibs:!1});else{const b=a.currentTarget,c=b.getBoundingClientRect();this.setState({showLibs:!this.state.showLibs,libDropDownLeft:c.left,libDropDownTop:c.top+25,libDropDownWidth:c.width}),this.props.onDropdownShow&&this.props.onDropdownShow(a)}},this.onSelectClick=(a)=>{this.props.setProjectLibVersion(this.state.libs[a]),this.setState({showLibs:!1})},this.onNewFeatureDetailClick=()=>{nw.Shell.openExternal("https://developers.weixin.qq.com/blogdetail?action=get_post_info&docid=34fde56e6ee55dac840952f4bf46cbfb&lang=zh_CN")};const b=vendorManager.getVendorConfig();this.mapping=this.buildLibsUsageRateMapping();let c=Object.keys(b.libs);const d=a.project;if(d&&d.shareInfo&&d.shareInfo.from&&d.shareInfo.from.minLib){const a=d.shareInfo.from.minLib;c=c.filter((b)=>0<=utilsTools.compareSemVer(b,a))}const e=c.map((a)=>this.mapping[a]&&this.mapping[a].toFixed(2)+"%"||"-"),f=c.map((a,b)=>{return"-"===e[b]?void 0:locales.config.USER_RATIO.format(" ".repeat(7-(this.mapping[a]&&this.mapping[a].toFixed(2).length)||7))}),g=d.scripts||{};this.state=Object.assign({vendorVersionDownloading:[],vendorVersionDownloadFailed:!1,lazyLoaded:!!a.show,libs:c,libsExt:e,libsHoverExt:f,libDropDownLeft:0,libDropDownTop:0,libDropDownWidth:200,showLibs:!1,showLibTip:!1},g),setTimeout(async()=>{try{const b=await vendorManager.setVersionAsync(a.project.libVersion);b!==a.project.libVersion&&a.setProjectLibVersion(b)}catch(a){log.error(a)}}),this.onMouseEnterLibTip=this.onMouseEnterLibTip.bind(this),this.onMouseLeaveLibTip=this.onMouseLeaveLibTip.bind(this)}componentDidMount(){vendorManager.on("VENDOR_CONFIG_CHANGE",this.onVendorChange),vendorManager.on("VENDOR_DOWNLOAD_START",this.onVendorDownloadStart),vendorManager.on("VENDOR_DOWNLOAD_FAIL",this.onVendorDownloadFail),vendorManager.on("VENDOR_DOWNLOAD_SUCCESS",this.onVendorDownloadSuccess),this.onVendorDownloadStart("null"),vendorManager.checkInit().then(()=>{this.onVendorDownloadComplete("null")}).catch(()=>{this.onVendorDownloadFail("null")})}componentWillUnmount(){vendorManager.off("VENDOR_CONFIG_CHANGE",this.onVendorChange),vendorManager.off("VENDOR_DOWNLOAD_START",this.onVendorDownloadStart),vendorManager.off("VENDOR_DOWNLOAD_FAIL",this.onVendorDownloadFail),vendorManager.off("VENDOR_DOWNLOAD_SUCCESS",this.onVendorDownloadSuccess)}componentWillReceiveProps(a){let b={};if(a.showDropDown!==this.props.showDropDown&&(b.showLibs=!1),a.show!==this.props.show&&a.show&&(b.lazyLoaded=!0),a.project!==this.props.project&&(b=Object.assign({},b,a.project.scripts)),a.publicLibUsageRateTotal!==this.props.publicLibUsageRateTotal){this.mapping=this.buildLibsUsageRateMapping(a.publicLibUsageRateTotal);const b=this.state.libs||[],c=b.map((a)=>this.mapping[a]&&this.mapping[a].toFixed(2)+"%"||"-"),d=b.map((a,b)=>{return"-"===c[b]?void 0:locales.config.USER_RATIO.format(" ".repeat(7-(this.mapping[a]&&this.mapping[a].toFixed(2).length)||7))});this.setState({libsExt:c,libsHoverExt:d})}0<Object.keys(b).length&&this.setState(b)}shouldComponentUpdate(a){return a.show!==this.props.show||this.props.show}buildLibsUsageRateMapping(a){const b={};return a=a?a:this.props.publicLibUsageRateTotal,a.forEach((a)=>{b[a.sdkVer]=a.percentage}),b}onSettingChange(a){const b=this.props.project.setting[a];this.props.setProjectSetting({[a]:!b});const c=this.props.project.appid;switch(a){case"es6":{report(b?"weapp_toolbar_details_closees6":"weapp_toolbar_details_openes6",c);break}case"minified":{report(b?"weapp_toolbar_details_closemin":"weapp_toolbar_details_openmin",c);break}case"postcss":{report(b?"weapp_toolbar_details_closecss":"weapp_toolbar_details_opencss",c);break}case"urlCheck":{report(b?"weapp_toolbar_details_closeurl":"weapp_toolbar_details_openurl",c);break}case"nodeModules":{report(b?"weapp_toolbar_details_disablenodemodules":"weapp_toolbar_details_enablenodemodules",c);break}case"autoAudits":{report(b?"weapp_toolbar_details_disableautoaudits":"weapp_toolbar_details_enableautoaudits",c);break}case"uglifyFileName":{report(b?"weapp_toolbar_details_disableuglifyfilename":"weapp_toolbar_details_enableuglifyfilename",c);break}}}onProjectScriptsChange(a,b){const c=b.target.value;this.setState({[a]:c}),clearTimeout(this.scriptChangeTimer),this.scriptChangeTimer=setTimeout(()=>{this.onProjectScriptsBlur()},3e3)}onProjectScriptsBlur(){clearTimeout(this.scriptChangeTimer),this.props.setProjectScripts({beforeCompile:this.state.beforeCompile||"",beforePreview:this.state.beforePreview||"",beforeUpload:this.state.beforeUpload||""})}onSPSelectClick(a){this.props.setProjectSimulatorPluginLibVersion(this.props.simulatorPluginLibs[a]),this.setState({showLibs:!1})}jumpToManagementCenter(){nw.Shell.openExternal("https://kf.qq.com/faq/171128zqiENn171128uyyEZz.html?scene_id=kf4595")}onClusterCompileClick(){const a=!this.props.compilerSettings.clusterCompile;this.props.updateIDESetting("compiler","clusterCompile",a)}onMouseEnterLibTip(){this.setState({showLibTip:!0})}onMouseLeaveLibTip(){this.setState({showLibTip:!1})}render(){if(!this.state.lazyLoaded)return null;const a=this.props,b=a.project,c=b.setting||{},d=`tab-content ${a.show?"tab-content-active":""}`;try{"number"!=typeof cpus&&(cpus=require("os").cpus().length)}catch(a){console.error(a)}const e=this.state.vendorVersionDownloading,f=this.state.vendorVersionDownloadFailed,g="en"===locales.getLocale()?"Preprocessing Command":"",h=b.simulatorType,i=h!==simulatorTypeConfig.wechat,j="zh"===locales.getLocale();let k=locales.config.WECHAT;return i&&(k=j?this.props.pluginManifests[h].name.zh:this.props.pluginManifests[h].name.en),React.createElement("div",{className:d},React.createElement("section",null,!b.isMiniCode&&b.runtimeAttr&&b.runtimeAttr.released&&!i?React.createElement("div",{className:"meta-item ui-flex"},React.createElement("label",{className:"meta-label"},locales.config.MIN_VER_BASE_LIB),React.createElement("p",{className:"ui-flex-item"},b.runtimeAttr.minPublicLibVersion||locales.config.NOT_SET),React.createElement("a",{onClick:this.jumpToManagementCenter},locales.config.VIEW_USER_BASE_LIB)):null,React.createElement("div",{className:"meta-item ui-flex"},React.createElement("label",{className:"meta-label-justify"},locales.config.DEBUG_BASE_LIB),React.createElement("i",{className:"ui-icon-ask",style:{position:"relative",marginLeft:"4px",marginRight:"24px"},onMouseEnter:this.onMouseEnterLibTip,onMouseLeave:this.onMouseLeaveLibTip},React.createElement("div",{className:"ui-poptips","data-position":"top",style:{display:this.state.showLibTip?"block":"none",position:"absolute",top:`${j?"-120":"-175"}px`,left:"-76px",width:"176px",letterSpacing:"1px"}},React.createElement("p",null,locales.config.LIBRARY_VERSION_TIP.format(k)))),React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("div",{className:"ui-selector ui-selector-default",onClick:this.onShowLibs},React.createElement("i",{className:f?"ui-icon-error":"ui-icon-spinner",style:{width:"22px",height:"20px",position:"absolute",left:"-24px",top:"6px",cursor:f?"pointer":"default",display:f||0<e.length?"":"none"},onClick:this.onVendorDownloadStatusClick,title:f?locales.config.CHECK_NETWORK_CONNECTION:locales.config.LOAD_PUBLIC_LIB}),React.createElement("input",{className:"ui-selector-input",placeholder:"",readOnly:!0,value:this.props.showSimulatorPluginLibs?this.props.simulatorPluginLibVersion:b.libVersion}),React.createElement("div",{className:"ui-selector-ext"},this.props.showSimulatorPluginLibs?"":this.mapping[b.libVersion]?this.mapping[b.libVersion].toFixed(2)+"%":""),React.createElement("div",{className:"ui-selector-dropdown"},React.createElement("i",{className:this.state.showLibs?"ui-icon-arrow-up-o":"ui-icon-arrow-down-o"})),React.createElement(DropDown,{show:this.state.showLibs,list:this.props.showSimulatorPluginLibs?this.props.simulatorPluginLibs:this.state.libs,listExt:this.props.showSimulatorPluginLibs?[]:this.state.libsExt,hoverExt:this.props.showSimulatorPluginLibs?[]:this.state.libsHoverExt,left:this.state.libDropDownLeft,top:this.state.libDropDownTop,width:this.state.libDropDownWidth,height:250,activeOption:this.props.showSimulatorPluginLibs?this.props.simulatorPluginLibVersion:this.props.project.libVersion,onSelectClick:this.props.showSimulatorPluginLibs?this.onSPSelectClick.bind(this):this.onSelectClick.bind(this)}))))),React.createElement("section",null,React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSettingChange.bind(this,"es6")},React.createElement("i",{className:c.es6?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.ES6_TO_ES5)))),"game"===b.compileType?null:React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSettingChange.bind(this,"postcss")},React.createElement("i",{className:c.postcss?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.AUTOCOMPLETED_WHEN_UPLOADING)))),React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSettingChange.bind(this,"minified")},React.createElement("i",{className:c.minified?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.AUTO_COMPRESSED_WHEN_UPLOADING)))),React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSettingChange.bind(this,"uglifyFileName")},React.createElement("i",{className:c.uglifyFileName?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.AUTO_UGLIFY_FILE_NAME_WHEN_UPLOAD)))),React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSettingChange.bind(this,"nodeModules")},React.createElement("i",{className:c.nodeModules?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.USE_NPM_MODLUE)))),"game"===b.compileType?null:React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSettingChange.bind(this,"autoAudits")},React.createElement("i",{className:c.autoAudits?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.AUTO_AUDITS)))),React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSettingChange.bind(this,"scriptsEnable")},React.createElement("i",{className:c.scriptsEnable?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.ENABLE_CUSTOM_PROCESSING)))),React.createElement("div",{style:{display:c.scriptsEnable?"":"none"}},React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("div",{className:"ui-form-item ui-form-item-inline"},React.createElement("label",{className:"ui-form-label ui-desc"},locales.config.PRE_COMPILATION_PREPROCESSING),React.createElement("div",{className:"ui-form-controls"},React.createElement("div",{className:"ui-input-box"},React.createElement("input",{type:"text",placeholder:g,className:"ui-input",value:this.state.beforeCompile,onBlur:this.onProjectScriptsBlur.bind(this),onChange:this.onProjectScriptsChange.bind(this,"beforeCompile")})))))),React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("div",{className:"ui-form-item ui-form-item-inline"},React.createElement("label",{className:"ui-form-label ui-desc"},locales.config.PRE_PREVIEW_PREPROCESSING),React.createElement("div",{className:"ui-form-controls"},React.createElement("div",{className:"ui-input-box"},React.createElement("input",{type:"text",placeholder:g,className:"ui-input",value:this.state.beforePreview,onBlur:this.onProjectScriptsBlur.bind(this),onChange:this.onProjectScriptsChange.bind(this,"beforePreview")})))))),React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("div",{className:"ui-form-item ui-form-item-inline"},React.createElement("label",{className:"ui-form-label ui-desc"},locales.config.PRE_UPLOAD_PREPROCESSING),React.createElement("div",{className:"ui-form-controls"},React.createElement("div",{className:"ui-input-box"},React.createElement("input",{type:"text",placeholder:g,className:"ui-input",value:this.state.beforeUpload,onBlur:this.onProjectScriptsBlur.bind(this),onChange:this.onProjectScriptsChange.bind(this,"beforeUpload")})))))))),React.createElement("section",null,React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSettingChange.bind(this,"urlCheck")},React.createElement("i",{className:c.urlCheck?"ui-icon-checkbox":"ui-icon-checkbox-o"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.NOT_VERIFY_VALIDITY)))),React.createElement("div",{className:"meta-item ui-flex",style:{display:"none"}},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onSettingChange.bind(this,"newFeature")},React.createElement("i",{className:c.newFeature?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.NEW_FEATURE_SOURCEMAP)),React.createElement("a",{style:{display:"none",color:"#0434fc",userSelect:"none",fontSize:13,verticalAlign:"text-bottom"},onClick:this.onNewFeatureDetailClick},locales.config.TOOLBAR_DETAILS)))),4<cpus&&React.createElement("section",null,React.createElement("div",{className:"meta-item ui-flex"},React.createElement("div",{className:"meta-value ui-flex-item"},React.createElement("label",{className:"ui-checkbox",onClick:this.onClusterCompileClick.bind(this)},React.createElement("i",{className:a.compilerSettings.clusterCompile?"ui-icon-checkbox-o":"ui-icon-checkbox"}),React.createElement("span",{className:"ui-checkbox-text"},locales.config.ENABLE_MULTI_CORE_COMPILATION))))))}};ProjectSetting=tslib_1.__decorate([locales.mixin],ProjectSetting),module.exports=connect(mapStateToProps,mapDispatchToProps)(ProjectSetting);
;}(require("lazyload"), require);
