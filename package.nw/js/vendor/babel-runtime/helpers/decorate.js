var _typeof=require("./typeof"),toArray=require("./toArray"),toPropertyKey=require("./toPropertyKey");function _decorate(e,r,t){var o=r(function(e){_initializeInstanceElements(e,i.elements)},t),i=_decorateClass(_coalesceClassElements(o.d.map(_createElementDescriptor)),e);return _initializeClassElements(o.F,i.elements),_runClassFinishers(o.F,i.finishers)}function _createElementDescriptor(e){var r,t=toPropertyKey(e.key);"method"===e.kind?(r={value:e.value,writable:!0,configurable:!0,enumerable:!1},Object.defineProperty(e.value,"name",{value:"symbol"===_typeof(t)?"":t,configurable:!0})):"get"===e.kind?r={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?r={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(r={configurable:!0,writable:!0,enumerable:!0});var o={kind:"field"===e.kind?"field":"method",key:t,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:r};return e.decorators&&(o.decorators=e.decorators),"field"===e.kind&&(o.initializer=e.value),o}function _coalesceGetterSetter(e,r){void 0!==e.descriptor.get?r.descriptor.get=e.descriptor.get:r.descriptor.set=e.descriptor.set}function _coalesceClassElements(e){function r(e){return"method"===e.kind&&e.key===n.key&&e.placement===n.placement}for(var t=[],o=0;o<e.length;o++){var i,n=e[o];if("method"===n.kind&&(i=t.find(r)))if(_isDataDescriptor(n.descriptor)||_isDataDescriptor(i.descriptor)){if(_hasDecorators(n)||_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+n.key+") can't be decorated.");i.descriptor=n.descriptor}else{if(_hasDecorators(n)){if(_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+n.key+").");i.decorators=n.decorators}_coalesceGetterSetter(n,i)}else t.push(n)}return t}function _hasDecorators(e){return e.decorators&&e.decorators.length}function _isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function _initializeClassElements(o,e){var i=o.prototype;["method","field"].forEach(function(t){e.forEach(function(e){var r=e.placement;e.kind!==t||"static"!==r&&"prototype"!==r||_defineClassElement("static"===r?o:i,e)})})}function _initializeInstanceElements(t,e){["method","field"].forEach(function(r){e.forEach(function(e){e.kind===r&&"own"===e.placement&&_defineClassElement(t,e)})})}function _defineClassElement(e,r){var t=r.descriptor;if("field"===r.kind){var o=r.initializer;t={enumerable:t.enumerable,writable:t.writable,configurable:t.configurable,value:void 0===o?void 0:o.call(e)}}Object.defineProperty(e,r.key,t)}function _decorateClass(e,r){var t=[],o=[],i={static:[],prototype:[],own:[]};if(e.forEach(function(e){_addElementPlacement(e,i)}),e.forEach(function(e){if(!_hasDecorators(e))return t.push(e);var r=_decorateElement(e,i);t.push(r.element),t.push.apply(t,r.extras),o.push.apply(o,r.finishers)}),!r)return{elements:t,finishers:o};var n=_decorateConstructor(t,r);return o.push.apply(o,n.finishers),n.finishers=o,n}function _addElementPlacement(e,r,t){var o=r[e.placement];if(!t&&-1!==o.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");o.push(e.key)}function _decorateElement(e,r){for(var t=[],o=[],i=e.decorators,n=i.length-1;0<=n;n--){var a=r[e.placement];a.splice(a.indexOf(e.key),1);var s=_fromElementDescriptor(e),l=_toElementFinisherExtras((0,i[n])(s)||s);_addElementPlacement(e=l.element,r),l.finisher&&o.push(l.finisher);var c=l.extras;if(c){for(var p=0;p<c.length;p++)_addElementPlacement(c[p],r);t.push.apply(t,c)}}return{element:e,finishers:o,extras:t}}function _decorateConstructor(e,r){for(var t=[],o=r.length-1;0<=o;o--){var i=_fromClassDescriptor(e),n=_toClassDescriptor((0,r[o])(i)||i);if(void 0!==n.finisher&&t.push(n.finisher),void 0!==n.elements){e=n.elements;for(var a=0;a<e.length-1;a++)for(var s=a+1;s<e.length;s++)if(e[a].key===e[s].key&&e[a].placement===e[s].placement)throw new TypeError("Duplicated element ("+e[a].key+")")}}return{elements:e,finishers:t}}function _fromElementDescriptor(e){var r={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(r,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(r.initializer=e.initializer),r}function _toElementDescriptors(e){if(void 0!==e)return toArray(e).map(function(e){var r=_toElementDescriptor(e);return _disallowProperty(e,"finisher","An element descriptor"),_disallowProperty(e,"extras","An element descriptor"),r})}function _toElementDescriptor(e){var r=String(e.kind);if("method"!==r&&"field"!==r)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+r+'"');var t=toPropertyKey(e.key),o=String(e.placement);if("static"!==o&&"prototype"!==o&&"own"!==o)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+o+'"');var i=e.descriptor;_disallowProperty(e,"elements","An element descriptor");var n={kind:r,key:t,placement:o,descriptor:Object.assign({},i)};return"field"!==r?_disallowProperty(e,"initializer","A method descriptor"):(_disallowProperty(i,"get","The property descriptor of a field descriptor"),_disallowProperty(i,"set","The property descriptor of a field descriptor"),_disallowProperty(i,"value","The property descriptor of a field descriptor"),n.initializer=e.initializer),n}function _toElementFinisherExtras(e){return{element:_toElementDescriptor(e),finisher:_optionalCallableProperty(e,"finisher"),extras:_toElementDescriptors(e.extras)}}function _fromClassDescriptor(e){var r={kind:"class",elements:e.map(_fromElementDescriptor)};return Object.defineProperty(r,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),r}function _toClassDescriptor(e){var r=String(e.kind);if("class"!==r)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+r+'"');_disallowProperty(e,"key","A class descriptor"),_disallowProperty(e,"placement","A class descriptor"),_disallowProperty(e,"descriptor","A class descriptor"),_disallowProperty(e,"initializer","A class descriptor"),_disallowProperty(e,"extras","A class descriptor");var t=_optionalCallableProperty(e,"finisher");return{elements:_toElementDescriptors(e.elements),finisher:t}}function _disallowProperty(e,r,t){if(void 0!==e[r])throw new TypeError(t+" can't have a ."+r+" property.")}function _optionalCallableProperty(e,r){var t=e[r];if(void 0!==t&&"function"!=typeof t)throw new TypeError("Expected '"+r+"' to be a function");return t}function _runClassFinishers(e,r){for(var t=0;t<r.length;t++){var o=(0,r[t])(e);if(void 0!==o){if("function"!=typeof o)throw new TypeError("Finishers must return a constructor.");e=o}}return e}module.exports=_decorate;