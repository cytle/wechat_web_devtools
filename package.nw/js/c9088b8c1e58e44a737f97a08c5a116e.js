'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){const a=require('react'),b=require('react-dom'),c=require('./cf139c99bcbda6ce0fa4054b089e2335.js'),d=require('./common/locales/index.js'),{model:f}=require('./63f52c9055d92f52ca0510da7d3dcadb.js'),g=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),h=require('./ff946754202ecf377034d29daac7c8d9.js'),{safeFormatSize:e,titleForEvent:i}=require('./96268d17c4410f0083b6c98f5e34acff.js'),j=(global.appConfig||{}).isDev;module.exports=class extends a.Component{constructor(){super(),this.state={events:[],askingForRetry:!1,retryCount:0,plain:'',inspectMode:!1}}onAskForRetry(a){return new Promise((b)=>{this._askingForRetryResolver=b,this.setState({askingForRetry:!0,retryCount:a})})}handleAskingForRetryResult(a){this.setState({askingForRetry:!1}),this._askingForRetryResolver&&(this._askingForRetryResolver(!!a),this._askingForRetryResolver=null)}handleUsingLocalStorageCheckboxChange(){const a=!this.props.remote.usingLocalStorage;!!a!==!!this.props.remote.usingLocalStorage&&this.props.changeUsingLocalStorage&&(this.props.changeUsingLocalStorage(a),this.setState({settingsTipsShow:!0}))}handleDisableUrlCheckCheckboxChange(){const a=!this.props.remote.disableUrlCheck;!!a!==!!this.props.remote.disableUrlCheck&&this.props.changeDisableUrlCheck&&(this.props.changeDisableUrlCheck(a),this.setState({settingsTipsShow:!0}))}componentDidMount(){f.subscribeChange((a)=>{this.onStatusChange(a)}),f.subscribeEvent((a)=>{a=a||{};const b=[{event:{kind:a.kind,type:i(a),message:a.message},timestamp:new Date},...this.state.events];this.setState({events:b})}),f.onAskForRetry(this.onAskForRetry.bind(this)),f.onOpenEditorFile(this.openEditorFile.bind(this)),this.onStatusChange();const a=b.findDOMNode(this.container);if(!a)return;let c,e;c=this.webview=document.createElement('webview'),c.setAttribute('partition','persist:devtools'),c.src='about:blank',a.appendChild(c),c.request.onBeforeRequest.addListener((a)=>{if(/^file:\/\//i.test(a.url))return{cancel:!0}},{urls:['<all_urls>']},['blocking']);const j=()=>{c.removeEventListener('loadcommit',j),c.addEventListener('dialog',(a)=>{a.preventDefault();const b=a.messageType,c=a.messageText,d=a.dialog;if('alert'!==b)'prompt'===b&&c===g.GET_MESSAGE_TOKEN&&d.ok(h.getToken());else if(d&&d.ok(),0<=c.indexOf('debugger:paused'))f.changeDebuggerStatus(1);else if(0<=c.indexOf('debugger:resumed'))f.changeDebuggerStatus(0);else if(0<=c.indexOf('opennewtab:')){const a=c.replace('opennewtab:','');this.handleNewWindow(a)}})},k=()=>{e.removeEventListener('loadcommit',k),e.showDevTools(!0,c);const a=`${c.getUserAgent()} remotedebugdevtools ${this.props.remote.usingLocalStorage?'usinglocalstorage':''} port/${global.messageCenterPort}`;c.setUserAgentOverride(a),c.src=`${this.props.remote.inspectUrl}`,c.setAttribute('style','position: relative; width: 100%; height: 100%; margin: 0 auto;'),c.addEventListener('loadcommit',j),e.parentNode.removeChild(e)},l=()=>{c.removeEventListener('loadcommit',l),e=document.createElement('webview'),e.style.visibility='hidden',e.src='about:blank',a.parentNode.insertBefore(e,a),e.addEventListener('loadcommit',k)};c.addEventListener('loadcommit',l),this._cancalLocaleListener=d.onChangeLocale(()=>this.forceUpdate())}componentWillUnmount(){this._cancalLocaleListener()}async openEditorFile(a){const b=this.props.project,c=b.miniprogramRoot?path.posix.join(b.projectpath,b.miniprogramRoot):b.projectpath,d=path.posix.relative(b.projectpath,path.posix.join(c,a.file));this.props.openEditorFile&&this.props.openEditorFile({file:`/${d}`,line:parseInt(a.line)})}onStatusChange(a){let b=f.getStatus();if((!b||a)&&(b={messager:{status:-1}}),this.setState(_extends({},this.state,b)),this.webview)if(b.currentSyncSdkName){const a=b.currentSyncSdkName;this.webview.executeScript({code:`(function() { try {
            var line = document.querySelector("#console-prompt .CodeMirror-lines[role='presentation']");
            line.setAttribute("data-sdkname", "${a}")
            line.classList.add("__sync");
          } catch(e) { } })();`})}else a?this.webview.src='html/debugger-end.html':this.webview.executeScript({code:`(function() { try {
            var line = document.querySelector("#console-prompt .CodeMirror-lines[role='presentation']");
            line.setAttribute("data-sdkname", "")
            line.classList.remove("__sync");
          } catch(e) { } })();`})}handleTmpClick(){nw.Shell.openItem(this.state.dirs.tempDir)}handleDirClick(){nw.Shell.openItem(this.state.dirs.dir)}handleFinishClick(){f.endDebug()}handleOuterClick(){document.activeElement.blur()}handleErrorsClear(){this.setState({events:[]})}handleToggleSection(a){const b=[...(this.state.foldedSections||[])];b[a]=!b[a],this.setState({foldedSections:b})}handleNewWindow(a){function b(a){try{nw.Window.open(a,{width:799,height:799})}catch(a){}}0===a.indexOf(`http://127.0.0.1:${global.proxyPort}/appservice/appservice`)||`http://127.0.0.1:${global.proxyPort}/favicon.ico`===a||0===a.indexOf('ws://')||0===a.indexOf('wss://')||a&&('https://developers.google.com/web/tools/chrome-devtools/'===a?(a='https://mp.weixin.qq.com/debug/wxadoc/dev/index.html',b(a)):'https://developers.google.com/web/updates/2017/05/devtools-release-notes'===a?(a='https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/new.html',b(a)):0==a.indexOf('wxfile://')?(a=a.replace('wxfile://','http://wxfile.open.weixin.qq.com/'),function(a){try{nw.Window.open(a,{width:799,height:799})}catch(a){}}(a)):b(a))}handleInspectModeChange(){const a=!this.state.inspectMode;this.setState({inspectMode:a});const b=f.getInstance();a?(c.send({command:'SHOW_PANNEL',data:{name:'Wxml'}}),b&&b.setInspectMode('searchForNode')):b&&b.setInspectMode('none')}render(){try{`data:image/png;base64,${this.props.remote.serverInfo.qrcode_img}`}catch(a){}const{messager:b={},_debugger:c={},dirs:f={},client:g={},syncCallIds:h={}}=this.state;g.deviceInfo=g.deviceInfo||{};const i=this.state.foldedSections||[];return a.createElement('div',{onClick:this.handleOuterClick.bind(this),className:'container'},a.createElement('div',{className:'debugger',ref:(a)=>this.container=a},a.createElement('div',{id:'mask',style:{display:this.state.askingForRetry?'block':'none'}})),a.createElement('div',{className:'detail'},a.createElement('div',{className:'detail-bd'},a.createElement('div',{className:'section'},a.createElement('div',{className:'section-hd',onClick:this.handleToggleSection.bind(this,0)},a.createElement('h3',null,g.deviceInfo.device_name||d.config.REMOTE_DEVICE_INFORMATION)),!i[0]&&a.createElement('div',{className:'section-bd'},a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.MOBILE_PHONE_MODEL),a.createElement('p',{className:'value'},g.deviceInfo.device_model||'-')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.OPERATING_SYSTEM),a.createElement('p',{className:'value'},g.deviceInfo.os||'-')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.WECHAT_VERSION),a.createElement('p',{className:'value'},g.deviceInfo.wechat_version||'-')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.BASE_LIBRARY_VERSION),a.createElement('p',{className:'value'},g.deviceInfo.displayPublib||g.deviceInfo.publib||'-')),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.ROUND_TRIP_TIME),a.createElement('p',{className:'value'},(()=>{return g.networkInterval&&isFinite(g.networkInterval)?600<g.networkInterval?a.createElement('span',{style:{fontWeight:'600',color:'red'}},g.networkInterval+'ms'):g.networkInterval+'ms':'-'})())),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.CONNECTION_MODE),a.createElement('p',{className:'value'},(()=>{const b=g.networkType;if('number'!=typeof b)return'-';return 0===b?a.createElement('span',{style:{color:'red',fontWeight:'600'}},d.config.REMOTE_DEBUG_NOT_CONNECTED):1===b?'2G':2===b?'3G':3===b?'4G':4===b?'Wi-Fi':-1===b?d.config.DATA_LINE_REMOTE_DEBUG.format('Android'):-2===b?d.config.DATA_LINE_REMOTE_DEBUG.format('iOS'):d.config.OTHER})())))),a.createElement('div',{className:'section'},a.createElement('div',{className:'section-hd',onClick:this.handleToggleSection.bind(this,1)},a.createElement('h3',null,d.config.CONNECTION_INFORMATION)),!i[1]&&a.createElement('div',{className:'section-bd'},a.createElement('div',{className:'meta '+(2>b.status?'meta-warn':'')},a.createElement('label',{className:'key'},d.config.CONNECTION_STATUS),a.createElement('p',{className:'value'},(()=>{const c=b.status;return-1===c?a.createElement('span',{style:{color:'red',fontWeight:'600'}},d.config.CONNECTION_CLOSED):0===c?a.createElement('span',{style:{fontWeight:'600'}},d.config.REMOTE_DEBUG_NOT_UNINITIALIZED):1===c?a.createElement('span',{style:{fontWeight:'600'}},d.config.REMOTE_DEBUG_NOT_CONNECTED):2===c?a.createElement('span',{style:{fontWeight:'600'}},d.config.REMOTE_DEBUG_LOGOUT):3===c?a.createElement('span',{style:{fontWeight:'600'}},d.config.REMOTE_DEBUG_LOGINING):4===c?d.config.REMOTE_DEBUG_WAIT_SERVICE:5===c?a.createElement('span',{style:{fontWeight:'600'}},d.config.REMOTE_DEBUG_SERVER_BLOCKING):6===c?d.config.REMOTE_DEBUG_WAITING_FOR_RESPONSE:7===c?d.config.NORMAL:a.createElement('span',{style:{color:'red',fontWeight:'600'}},d.config.REMOTE_DEBUG_UNKNOWN)})()),7>=b.status&&4<=b.status?a.createElement('div',{className:'ext'},a.createElement('i',{className:'ui-icon-circle'})):null),a.createElement('div',{className:'meta '+(2>b.status?'meta-warn':'')},a.createElement('label',{className:'key'},d.config.SERVICE_STATE),a.createElement('p',{className:'value'},(()=>{const c=b.status;return-1===c||0===c||1===c?a.createElement('span',{style:{fontWeight:'600'}},d.config.REMOTE_DEBUG_NOT_CONNECTED):2===c||3===c||4===c?d.config.NORMAL:5===c?a.createElement('span',{style:{fontWeight:'600'}},d.config.REMOTE_DEBUG_SERVER_BLOCKING):6===c||7===c?d.config.NORMAL:d.config.REMOTE_DEBUG_UNKNOWN})()),7>=b.status&&a.createElement('div',{className:'ext'},a.createElement('i',{className:'ui-icon-circle'}))),j&&a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.NETWORK_SEND),a.createElement('p',{className:'value'},e(b.outBytesCount))),j&&a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.RECEIVED),a.createElement('p',{className:'value'},e(b.inBytesCount))),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.TRAFFIC),a.createElement('p',{className:'value'},e(b.inBytesCount+b.outBytesCount))),0<b.compressionSavedBytes?a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.COMPRESSION_SAVING),a.createElement('p',{className:'value'},e(b.compressionSavedBytes))):null,a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.RECEIVE_MESSAGES),a.createElement('p',{className:'value'},b.inDebugMessageCount||0)),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.SEND_MESSAGES),a.createElement('p',{className:'value'},b.outDebugMessageCount||0)),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.SEND_RATE),a.createElement('p',{className:'value'},(b.outDebugMessageSpeed||0)+d.config.PER_SECOND)),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.RECEIVE_RATE),a.createElement('p',{className:'value'},(b.inDebugMessageSpeed||0)+d.config.PER_SECOND)),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.WAIT_FOR_SENDING),a.createElement('p',{className:'value'},b.cachedDebugMessagesCount||0)),a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.UNCONFIRMED),a.createElement('p',{className:'value'},b.unconfirmedMessagesCount||0)),j&&a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.SENT_PACKAGE),a.createElement('p',{className:'value'},b.outCount||0)),j&&a.createElement('div',{className:'meta'},a.createElement('label',{className:'key'},d.config.RECEIVED_PACKAGE),a.createElement('p',{className:'value'},b.inCount||0)))),this.state.askingForRetry||0<this.state.events.length?a.createElement('div',{className:'section'},a.createElement('div',{className:'section-hd'},a.createElement('h3',null,d.config.WARNINGS_AND_ERRORS),a.createElement('div',{className:'section-hd-extra',onClick:this.handleErrorsClear.bind(this)},a.createElement('i',{className:'ui-icon-circle-x'}),a.createElement('span',null,this.state.events.length||0))),a.createElement('div',{className:'section-bd section-bd-warn'},this.state.askingForRetry?a.createElement('div',{className:'msg-area'},a.createElement('div',{className:'msg-text-area'},a.createElement('p',null,a.createElement('i',{className:'ui-icon-error'}),d.config.CONNECTION_BROKEN_RECONNECT)),a.createElement('div',{className:'msg-button-area'},a.createElement('button',{className:'ui-button ui-button-primary',onClick:this.handleAskingForRetryResult.bind(this,!0)},d.config.RECONNECT))):null,this.state.events.map((b,c)=>{return b&&b.event&&b.event.type?a.createElement('div',{className:'msg '+(b.event.kind?'error-'+b.event.kind:''),key:c},'error'===b.event.kind?a.createElement('i',{className:'ui-icon-circle-x'}):null,a.createElement('p',null,(b.timestamp||new Date).toLocaleTimeString()),a.createElement('p',null,d.config.REMOTE_DEBUG_TYPE,b.event.type),b.event.message&&a.createElement('p',null,d.config.REMOTE_DEBUG_DETAILS,b.event.message)):null}))):null,a.createElement('div',{className:'section'},a.createElement('div',{className:'section-hd',onClick:this.handleToggleSection.bind(this,3)},a.createElement('h3',null,d.config.SETTING)),!i[3]&&a.createElement('div',{className:'section-bd'},a.createElement('label',{htmlFor:'',className:'ui-checkbox',onClick:this.handleUsingLocalStorageCheckboxChange.bind(this)},a.createElement('i',{className:this.props.remote.usingLocalStorage?'ui-icon-checkbox-o':'ui-icon-checkbox'}),a.createElement('span',{className:'ui-checkbox-text'},d.config.USE_TOOL_END_STORAGE)),a.createElement('label',{htmlFor:'',className:'ui-checkbox',style:{margin:'10px 0'},onClick:this.handleDisableUrlCheckCheckboxChange.bind(this)},a.createElement('i',{className:this.props.remote.disableUrlCheck?'ui-icon-checkbox-o':'ui-icon-checkbox'}),a.createElement('span',{className:'ui-checkbox-text'},d.config.NOT_VERIFY_VALIDITY)),this.state.settingsTipsShow&&a.createElement('p',{className:'option',style:{color:'#999',fontSize:'12px',marginLeft:'25px',marginBottom:'25px'}},d.config.TAKE_EFFECTS_NEXT_DEBUGGING),122<=g.deviceInfo.publib&&a.createElement('label',{htmlFor:'',className:'ui-checkbox',onClick:this.handleInspectModeChange.bind(this)},a.createElement('i',{className:this.state.inspectMode?'ui-icon-checkbox-o':'ui-icon-checkbox'}),a.createElement('span',{className:'ui-checkbox-text'},d.config.NODE_INSPECTION_MODE))))),a.createElement('div',{className:'detail-ft'},a.createElement('a',{className:'hero',onClick:this.handleFinishClick.bind(this)},d.config.STOP_DEBUGGING))))}}}(require('lazyload'),require);