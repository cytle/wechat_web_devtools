'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){function a(a){const b=l.getUserInfo(),c=b&&b.openid?b.openid:'unknow',d=n.getState(),e=d.project.current,f=e.storage||{};let g={};if(f.openid==c)g=_extends({},f.cache);else{const b=`storage_${d.project.current.hash}_${c}`,e=h.join(o.WeappStorage,`${b}.json`);try{g=JSON.parse(i.readFileSync(e,'utf8'))}catch(a){console.log(a,'trying old cache file'),g={};try{const a=`${d.project.current.hash}_${c}`,b=h.join(o.WeappStorage,`${a}.json`);g={0:JSON.parse(i.readFileSync(b,'utf8'))}}catch(a){console.log(a),g={}}}a({type:j.PROJECT_SET_STORAGE,data:{openid:c,cache:g}})}const m=p.get(k.isGameApp(e)?'storage_game':'storage_miniprogram');return m.triggerOnEvent('UPDATE_STORAGE',g),g}function b(a,b){const c=l.getUserInfo(),d=c&&c.openid?c.openid:'unknow';a({type:j.PROJECT_SET_STORAGE,data:{openid:d,cache:b}});const e=p.get(k.isGameApp()?'storage_game':'storage_miniprogram');e.triggerOnEvent('UPDATE_STORAGE',b)}async function c(b,c){const d=a(b),e=c.args,f=e.key;let g=e.storageId,h={};if(g===void 0)g=0;else if(0!==g&&1!==g)return{errMsg:`${c.api}:fail nonexistent storage space`};h=d[g]||{};const i=h[f];return void 0===i?{errMsg:`${c.api}:fail data not found`}:{errMsg:`${c.api}:ok`,data:i.data,dataType:i.dataType}}async function d(c,d){const e=a(c),f=k.getCurrentConfig(),g=d.args,h=g.key;let i=g.storageId,j={};if(i===void 0)i=0;else if(0!==i&&1!==i)return{errMsg:`${d.api}:fail nonexistent storage space`};j=e[i]||{},e[i]=j;const l=g.data,n=g.dataType;j[h]={data:l,dataType:n};const o=f&&f.setting&&f.setting.OpendataMaxLocalStorageSize?f.setting.OpendataMaxLocalStorageSize:m.setting.OpendataMaxLocalStorageSize,p=f&&f.setting&&f.setting.MaxLocalstorageSize?f.setting.MaxLocalstorageSize:m.setting.MaxLocalstorageSize,q=0===i?p:o;return JSON.stringify(e).length>1024*(1024*q)?{errMsg:`${d.api}:fail exceed storage max size ${q}Mb`}:(b(c,e),{errMsg:`${d.api}:ok`})}async function e(c,d){const e=(d||{}).args;let f=(e||{}).storageId;const g=a(c);let h={};if(void 0===f)f=0;else if(0!==f&&1!==f)return{errMsg:`${d.api}:fail nonexistent storage space`};h=g[f]||{},g[f]=h;const i=_extends({},g,{[f]:{}});return b(c,i),{errMsg:`${d.api}:ok`}}async function f(c,d){const e=a(c),f=d.args,g=f.key;let h=f.storageId,i={};if(void 0===h)h=0;else if(0!==h&&1!==h)return{errMsg:`${d.api}:fail nonexistent storage space`};return i=e[h]||{},e[h]=i,delete i[g],b(c,e),{errMsg:`${d.api}:ok`}}async function g(b,c){const d=k.getCurrentConfig();c=c||{};let e=(c.args||{}).storageId;const f=a(b);let g={};if(void 0===e)e=0;else if(0!==e&&1!==e)return{errMsg:`${c.api}:fail nonexistent storage space`};g=f[e]||{},f[e]=g;const h={keys:Object.keys(g),currentSize:Math.ceil(JSON.stringify(g).length/1024)},i=d&&d.setting&&d.setting.MaxLocalstorageSize?d.setting.MaxLocalstorageSize:m.setting.MaxLocalstorageSize;return h.limitSize=1024*i,h.errMsg=`${c.api}:ok`,h}const h=require('path'),i=require('fs'),j=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),k=require('./3bfffbe88b3d923921f851c0697974fe.js'),l=require('./89ba85d67a88f7636d657c22b5d3e038.js'),m=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),n=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js'),o=require('./92320c1386e6db6a6f2556736a9bc280.js'),p=require('./e9e3fd38aeedddd6db73d1d015ff6952.js');module.exports={getStorage:c,clearStorage:e,setStorage:d,removeStorage:f,getStorageInfo:g,getStorageSync:c,setStorageSync:d,clearStorageSync:e,removeStorageSync:f,getStorageInfoSync:g}}(require('lazyload'),require);