'use strict';!function(require,directRequire){async function a(a,b){let c,d=2;return c=p.isGameApp(a)?await v(a):await u(a),d=c.subPackages?b.setting.MaxSubpackageFullCodeSize||b.setting.MaxCodeSize:b.setting.MaxCodeSize,d}const b=require('fs'),c=require('path'),d=require('rmdir'),e=require('zlib'),f=require('./72653d4b93cdd7443296229431a7aa9a.js'),g=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),h=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),i=require('./1fcc6bd55b687d154a4247e57fe3011d.js'),j=require('./db2217eb4cff896bdcbc50abe005058f.js'),k=require('./15ba1827c7f6564a45df6bd44da3a977.js'),l=require('./f171257bbcaef547a3cf27266ccb0db2.js'),m=require('./92320c1386e6db6a6f2556736a9bc280.js'),n=require('./949d8235c744ced2a80121e4dba34c28.js'),o=require('./common/locales/index.js'),p=require('./3bfffbe88b3d923921f851c0697974fe.js'),q=require('./911222a6723da8db7ca8a8e3689591e1.js'),r=require('./e5fa35c3c8e81bc6466b4b8eb436113b.js'),s=require('./bcb48ae14d243711d3b31cb0f602d209.js'),t=require('./08cdbb558c25b102c0d6c3c9f05851aa.js'),u=require('./1dea83a77e99a7c94f6b6f01f5c175b0.js'),v=require('./1bd2563d13db26950ae47494b2c34454.js'),w=()=>({type:h.DEBUG_CUSTOM_ANALYSIS_CLOSE}),x=()=>({type:h.DEBUG_MOBILE_TEST_CLOSE});module.exports={openCustomAnalysis:()=>(a,b)=>{const{project:c,debug:d}=b();if(!c.current)return;if(c.current.appid===g.TOURIST_APPID)return void a(i.setConfirmInfo({show:!0,showCancel:!1,title:o.config.ALERT_TOURIST_FORBIDDEN_TITLE,content:o.config.ALERT_TOURIST_FORBIDDEN_CONTENT}));let e;(e=j.get('custom_analysis'))?e.focus():(d.customAnalysis.isOpen&&a(w()),a({type:h.DEBUG_CUSTOM_ANALYSIS_OPEN}))},closeCustomAnalysis:w,updateCustomAnalysisConfig:(a)=>({type:h.DEBUG_CUSTOM_ANALYSIS_UPDATE_CONFIG,config:a}),openMobileTest:()=>(a,b)=>{const{project:c,debug:d}=b();if(!c.current)return;if(c.current.appid===g.TOURIST_APPID)return void a(i.setConfirmInfo({show:!0,showCancel:!1,title:o.config.ALERT_TOURIST_FORBIDDEN_TITLE,content:o.config.ALERT_TOURIST_FORBIDDEN_CONTENT}));let e;(e=j.get(g.WINDOW_REGISTRY.MOBILE_TEST))?e.focus():(d.mobileTest.isOpen&&a(x()),a({type:h.DEBUG_MOBILE_TEST_OPEN}))},closeMobileTest:x,commitMobileTest:(f,g,h=!0)=>(j)=>new Promise(async(u,v)=>{try{t({priority:1,title:o.config.START_APPLY_TEST,message:o.config.START_APPLY_TEST},{type:s.DBType.system,content:o.config.START_APPLY_TEST,timestamp:Date.now()/1e3},!0),f&&g||(f=p.getCurrentConfig(),g=p.getCurrent());let v;try{v=await a(g,f)}catch(a){try{v=f.setting.MaxCodeSize}catch(a){v=4}}const w=1024*(1024*v),x=await q(g,{noCompile:!0}),y=m.Weappdest,z=c.join(y,`${+new Date}.wx`),A=await r(x,z),B=A.destPath,C=A.data;d(x,()=>{});const D=C.length;if(D>w){b.unlink(z,()=>{});const a=new Error(o.config.CODE_SIZE_EXCEED.format([parseInt(D/1024),parseInt(w/1024)]));throw a.code=n.CODE_SIZE_EXCEED,a}const E=e.gzipSync(C),{body:F}=await k({url:`${l.commitMobileTest}?gzip=1&appid=${f.appid}`,method:'post',body:E,needToken:1});h&&j(i.showSuccessTip(o.config.TEST_APPLICATION_SUCCESSFUL)),u()}catch(a){v(a),h&&j(i.setConfirmInfo({show:!0,showCancel:!1,content:o.config.APPLY_UNSUCCESSFULLY_REASON+a.toString()})),console.error(o.config.APPLY_AUTO_TEST_ERR_REASON,a.toString())}}),getMobileTestInfo:()=>(a)=>new Promise(async(b,c)=>{try{const{body:c}=await k({url:`${l.getMobileTestInfo}`,needToken:1,needAppID:1});b(c.test_list||[]),a({type:'DEBUG_MOBILE_TEST_FETCH_LIST',list:c.test_list||[]})}catch(a){c(a)}}),viewMobileTestReport:(a)=>(b)=>new Promise(async()=>{let c;(c=j.get(`mobile_test_report_${a}`))?c.window.focus():b({type:h.DEBUG_MOBILE_TEST_VIEW_REPORT,testid:a})}),closeMobileTestReport:(a)=>({type:h.DEBUG_MOBILE_TEST_CLOSE_REPORT,testid:a}),downloadAutoTestReport:()=>()=>new Promise(async()=>{})}}(require('lazyload'),require);