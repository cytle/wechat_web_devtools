;!function(require, directRequire){;"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const URL=require("url"),path=require("path"),weappConfig=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),nwReportURL="https://clients1.google.com/tbproxy/af/",aboutblank="http://aboutblank",{weappURLRegular,weappASURLRegular,weappLocalIdRegular,weappEditorServiceRegular,weappPluginServiceRegular,weappWidgetPageRegular,weappWidgetServiceRegular,weappGamePageRegular,weappTraceRegular,weappUsrFileReqular,weappStoreFileReqular,weappTmpFileReqular,weappUsrFilePathPrefix,weappTmpFilePathPrefix,weappStoreFilePathPrefix}=weappConfig,sourceManager=require('./730f2a99f4d5cff2946dd0a3bad0a600.js'),tracer=require('./07af6655c180a0694f993b79d5b077df.js'),idepluginManager=require('./f5a748840b272d2bf0223c95f6c8dbe3.js'),{validType,tokenManager}=require('./dc244a5ba483ad6e0acd267d3b91b282.js');function trasnlateReqToUrlParse(a){const b=a.headers.host,c=!a.connection.encrypted||/^http:/.test(a.url)?"http":"https",d="http"==c?a.url:c+"://"+b+a.url,e=URL.parse(d);return e.pureHref=e.href&&e.href.replace(/\?.*/,"").replace(/\#.*/,""),e}function validateUAToken(a){const b=a.headers["user-agent"]||"",c=b.match(/token\/(\S*)/);return c&&c[1]&&tokenManager.validateSessionToken(c[1],validType.UA_TOKEN)}module.exports={forceLocalProxy:[weappURLRegular,weappASURLRegular,weappLocalIdRegular,aboutblank,nwReportURL,weappEditorServiceRegular,weappPluginServiceRegular,weappWidgetPageRegular,weappWidgetServiceRegular,weappGamePageRegular,weappTraceRegular,weappUsrFileReqular,weappStoreFileReqular,weappTmpFileReqular],dealLocalResponse(a,b,c){const d=trasnlateReqToUrlParse(a),e=d.pureHref;if(weappLocalIdRegular.test(e)||0===e.indexOf("http://"+weappTmpFilePathPrefix+"/")||0===e.indexOf("http://"+weappStoreFilePathPrefix+"/")||0===e.indexOf("http://"+weappUsrFilePathPrefix+"/")||0===e.indexOf("/"+weappTmpFilePathPrefix+"/")||0===e.indexOf("/"+weappStoreFilePathPrefix+"/")||0===e.indexOf("/"+weappUsrFilePathPrefix+"/"))return void sourceManager.getLocalIdResponse(e.replace(weappLocalIdRegular,"wxfile://")).then((a)=>{c(200,{},a)}).catch(()=>{c(404,{},"")});if(0===e.indexOf("/aboutblank")||0===e.indexOf("/favicon.ico")||0===e.indexOf(nwReportURL)||0===e.indexOf(aboutblank))return void c(200,{},"");if(!validateUAToken(a))return c(403,{},"");if(0===e.indexOf("/appservice"))return void sourceManager.getAppServiceSource(e).then((a)=>{c(200,{},a)}).catch(()=>{c(404,{},"")});if(0===e.indexOf("/calibration"))return void c(200,{},"");if(0===e.indexOf("/__pageframe__")){const a=d.href;return void sourceManager.getWebviewSource(a).then((b)=>{const d={};".svg"===path.extname(a)&&(d["Content-Type"]="image/svg+xml"),c(200,d,b)}).catch(()=>{c(404,{},"")})}if(0===e.indexOf("/editor"))return void sourceManager.getEditorSource(e).then((a)=>{c(200,a.headers||{},a.body)}).catch(()=>{c(404,{},"")});if(0===e.indexOf("/trace"))return void tracer.getTraceRoute(d,(a,b)=>{a?c(500,{},JSON.stringify(a.message)):c(200,{},JSON.stringify(b))});if(0===e.indexOf("/widgetwebview"))return void sourceManager.getWidgetWebviewResource(e).then((a)=>{c(200,{},a)}).catch(()=>{c(404,{},"")});if(0===e.indexOf("/widgetservice"))return void sourceManager.getWidgetServiceResource(e).then((a)=>{c(200,{},a)}).catch(()=>{c(404,{},"")});if(0===e.indexOf("/game"))return void sourceManager.getGamePageResource(e).then((a)=>{c(200,{},a)}).catch((a)=>{c(404,{},a.toString())});if(weappGamePageRegular.test(e))return void sourceManager.getGamePageResource(e).then((a)=>{c(200,{},a)}).catch((a)=>{c(404,{},a.toString())});if(0===e.indexOf("/"+weappUsrFilePathPrefix))return void sourceManager.getUsrFileResponse(e).then((a)=>{c(200,{},a)}).catch(()=>{c(404,{},"")});if(0===e.indexOf("/ideplugin")||weappPluginServiceRegular.test(e)){const a=e.match(/.*?\/ideplugin\/([^\/]*)\//);if(!a)return void c(404,{},"");const b=a[1],d=e.replace(/.*?\/ideplugin\/([^\/]*)\//,"");return"devtools"===b?void idepluginManager.getDevtoolsManifest().then((a)=>{c(200,{},a)}).catch(()=>{c(404,{},"")}):void idepluginManager.getFile(b,d).then((a)=>{const b={};".svg"===path.extname(d)&&(b["Content-Type"]="image/svg+xml"),c(200,b,a)}).catch(()=>{c(404,{},"")})}0===e.indexOf("/experience")&&sourceManager.getExperienceResource(e).then((a)=>{c(200,{},a)}).catch((a)=>{c(404,{},a.toString())})}};
;}(require("lazyload"), require);
