module.exports=function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1289)}({0:function(e,n){e.exports=require("util")},1:function(e,n){e.exports=require("path")},108:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const o=t(227);let r="zh";n.getLocale=()=>r,n.setLocale=e=>{switch(e){case"zh":case"en":r=e}};const s=(e,n,t)=>{try{let o=e;e.__esModule&&(o=e.default);for(const e of n)o=o[e];return o}catch(e){return t}};function i(e,{form:n="defaults",values:t=[]}={}){const i=s(o.default,[e,r,n],void 0);if(!i)return s(o.default,[e,r,"defaults"],void 0)||s(o.default,[e,"en",n],void 0)||s(o.default,[e,"en","defaults"],void 0)||"undefined";if(i.includes("%s")){const e=function(e){return function*(){for(const n of e)yield n}}(t)();return i.replace(/%s/g,()=>e.next().value)}return i}n.translate=function(e,...n){return i(e,{values:n,form:"defaults"})},n.complexTranslate=i},1289:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const o=t(13),r=t(1),s=t(1290),i=t(0),a=t(108),c=2e4;class l{constructor(e){this.id=e.workerId,this.functionInfo=e.functionInfo,this.setupRequestIdenfiers(),this.load(),this.setupInnerCommunicationServer(),this.setupInspect()}load(){let e,n;try{n=(e=require(r.join(this.functionInfo.dir,this.functionInfo.entryFile)))[this.functionInfo.mainHandler]}catch(e){return d("error",e),void process.exit(1)}if(this.handler=n,!n)throw new Error(a.translate("functionMustExportMainHandler",this.functionInfo.mainHandler))}setupInnerCommunicationServer(){const e=o.createServer((e,n)=>{p("info",`[worker#${this.id}] receiving a request`);const t=[];e.on("data",e=>t.push(e)).on("end",()=>{const o=Buffer.concat(t).toString(),r=JSON.parse(o);n.on("error",e=>{d("error",`[INTERNAL ERROR] ${a.complexTranslate("errorWhileProcessing",{form:"internalResponse"})}`,e)}),d("info",a.translate("functionTriggeredNotice")),p("info",`[worker#${this.id}] request body received: `,o);const s=+new Date;let l,u=!1,h=c;r.hasOwnProperty("timeoutDuration")&&i.isNumber(r.timeoutDuration)&&(h=r.timeoutDuration),h>0&&(l=setTimeout(()=>{if(!u){u=!0;const e=`function exection timeout (${h/1e3}s)`;console.error(e);const t=new Error(e);n.statusCode=500,n.end(JSON.stringify({name:t.name,message:t.message,stack:t.stack}))}},h));const g=e=>{u||(u=!0,d("error",a.complexTranslate("functionHandlerExecutionResult",{form:"fail",values:[+new Date-s]}),e),clearTimeout(l),e=e instanceof Error?e:new Error(e),n.statusCode=500,n.end(JSON.stringify({name:e.name,message:e.message,stack:e.stack})))},m=e=>{u||(u=!0,d("info",a.complexTranslate("functionHandlerExecutionResult",{form:"success",values:[+new Date-s]}),e),clearTimeout(l),n.end(JSON.stringify(e)))},y={};try{if(r.env&&f(r.env))for(const e in r.env)"@@DELETE"===r.env[e]?delete process.env[e]:process.env[e]=r.env[e];r.requestId&&(this.requestId=r.requestId),r.callStack&&(this.callStack=r.callStack||[]),"https"===this.functionInfo.triggerType?(n.on("finish",m),this.handler(e,n)):Promise.resolve().then(()=>this.handler(r.data,y)).then(m).catch(g)}catch(e){g(e)}}).on("error",e=>{d("error",`[INTERNAL ERROR] ${a.complexTranslate("errorWhileProcessing",{form:"request"})}`,e)})});e.listen(0,"localhost",()=>{process.send&&process.send({type:"notify",event:"servicePort",data:e.address().port})})}setupRequestIdenfiers(){const e=this,n=this.id,t=this.functionInfo.id,r=o.request;function s(o){o["X-WORKER-ID"]=n,o["X-FUNCTION-ID"]=t,o["X-CALL-STACK"]=JSON.stringify(e.callStack||[]),o["X-REQUEST-ID"]=e.requestId||"unknown",o["X-ORIGIN-ENV"]=JSON.stringify(process.env)}o.request=function(){const e=f(arguments[0])?arguments[0]:f(arguments[1])?arguments[1]:null;return e?(f(e.headers)||(e.headers={}),s(e.headers)):3===r.length&&"string"===u(arguments[0])&&function(e){return"function"==typeof e}(arguments[1])&&(arguments[2]=arguments[1],arguments[1]={},s(arguments[1])),r.apply(this,arguments)}}setupInspect(){this.functionInfo.inspect&&(process.execArgv.find(e=>"--inspect-brk"===e||"--debug-brk"===e)||s.url()||s.open(0),h())}reload(){d("info",a.translate("reloadOnFileChangeHint"));for(const e in require.cache)delete require.cache[e];this.load(),d("info",a.complexTranslate("reloadOnFileChangeHint",{form:"done"}))}}function u(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function f(e){return"object"===u(e)}function d(e,...n){const t=[`%c[${e=e||"info"}]`];"warn"===e?console.warn.apply(console,[...t,"color: blue; font-weight: bold",...n]):"error"===e?console.error.apply(console,[...t,"color: red; font-weight: bold",...n]):console.log.apply(console,[...t,"color: yellowgreen; font-weight: bold",...n])}function p(e,...n){0}function h(){process.send&&process.send({type:"notify",event:"inspectURL",data:s.url()})}process.on("uncaughtException",e=>{d("error","Uncaught Exception: ",e)}),process.on("unhandledRejection",(e,n)=>{d("error","Unhandled Rejection at:",n,"reason:",e)}),function(){let e;if(process.on("message",n=>{switch(p(0,global.worker&&global.worker.id),n.type){case"action":!function(n){switch(n.action){case"init":!function(n){if(n.data.locale)switch(n.data.locale){case"zh":case"en":a.setLocale(n.data.locale)}e=global.worker=new l(n.data)}(n);break;case"inspect":!function(e){if(!1!==e.data.enable){const e=s.url();if(e)return h();s.open(0),h()}else s.close()}(n);break;case"print":!function(e){d(e.data.level||"info",e.data.content)}(n);break;case"reload":e&&e.reload()}}(n)}}),!process.send)throw new Error("worker can only be started as a child process");process.send({type:"notify",event:"ready"}),p()}()},1290:function(e,n){e.exports=require("inspector")},13:function(e,n){e.exports=require("http")},227:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={functionMustExportMainHandler:{en:{defaults:"function module must export the handler of name '%s'"},zh:{defaults:"函数必须导出名为 '%s' 的方法"}},errorWhileProcessing:{en:{defaults:"",internalResponse:"encounter an error while processing internal response",request:"encounter an error while processing a request"},zh:{defaults:"",internalResponse:"在处理内部响应时遇到错误",request:"在处理一个请求时遇到错误"}},functionTriggeredNotice:{en:{defaults:"function is triggered, starting execution...",concurrentWaitWarning:"%s requests pending execution (in local debug mode, only 1 local cloud function instance is running and requests are executed sequentially)"},zh:{defaults:"函数被触发，正在执行中...",concurrentWaitWarning:"%s 个请求正在等待执行（在本地调试中，每个云函数有一个本地实例，请求串行执行）"}},functionHandlerExecutionResult:{en:{defaults:"",fail:"function execution fail (cost %sms)",success:"function execution success (cost %sms)"},zh:{defaults:"",fail:"函数执行失败（耗时 %sms）",success:"函数执行成功（耗时 %sms）"}},callGraphResult:{en:{defaults:"",title:"the call to %s function '%s' has finished",timeCost:"(cost %sms)",itsCallGraph:"its call graph",notice:"Be aware: call graph of online cloud function couldn't be displayed, that is to say, if there're any function calls from within a online cloud function, they won't appear in the above call graph."},zh:{defaults:"",title:"调用 %s 云函数 '%s' 完成",timeCost:"（耗时 %sms）",itsCallGraph:"调用图",notice:"注意: 此处不包含云端云函数端发起的调用，也就是说，如果云端云函数发起了对其他云函数的调用，在上图中将不会展现。"}},recursiveCallDetection:{en:{defaults:"Recursive function call detected! Recursive call is prohibited by default in local debugger because recursive function call may lead to infinite recursion in production, please use with caution. \n\nThe call stack: \n\n%s\n\n"},zh:{defaults:"检测到循环调用！在本地调试中云函数递归调用是被默认禁止的，云函数递归调用可能导致死循环问题，因此请谨慎使用。调用栈：\n\n%s\n\n"}},reloadOnFileChangeHint:{en:{defaults:"Local file changed, reloading function...",done:"Function reload done."},zh:{defaults:"检测到本地文件变更，重新载入函数中...",done:"函数重载完成"}},punctuation:{en:{defaults:"",wordSeparator:"",comma:",",colon:":"},zh:{defaults:"",wordSeparator:" ",comma:"，",colon:"："}},local:{en:{defaults:"local"},zh:{defaults:"本地"}},remote:{en:{defaults:"cloud"},zh:{defaults:"云端"}},templateResource:{en:{defaults:""},zh:{defaults:""}}}}});