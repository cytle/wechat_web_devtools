'use strict';!function(require,directRequire){async function a(a){let g,p,t;a.tempProject?(g=a.tempProject.attr,p=a.tempProject):(g=o.getCurrentConfig(),p=o.getCurrent());try{const a=await m(p);t=a.subPackages?g.setting.MaxSubpackageFullCodeSize||g.setting.MaxCodeSize:g.setting.MaxCodeSize}catch(a){try{t=g.setting.MaxCodeSize}catch(a){t=2}}let v=1024*t;const w=a.onProgressUpdate||u;w('buildstart','\u6B63\u5728\u7F16\u8BD1\u4EE3\u7801');let x=await j(p,{noCompile:!0,onProgressUpdate:w,onFilesIgnored:a.onFilesIgnored});w('buildend','\u7F16\u8BD1\u4EE3\u7801\u5B8C\u6210'),w('packstart','\u6B63\u5728\u6253\u5305');let y=c.join(q,`${+new Date}.wx`),z=await k(x,y);b.unlink(y,()=>{}),w('packend','\u6253\u5305\u5B8C\u6210'),w('uploadstart','\u6B63\u5728\u4E0A\u4F20');let A=z.data,B=z.pDestPath;e(x,()=>{});let C=parseInt(z.totalSize/1024);if(C>v){let a=new Error(n.config.CODE_SIZE_EXCEED.format([C,v]));throw a.code=i.CODE_SIZE_EXCEED,a}let D,E=global.appConfig.isBeta;if(a.test){if(l[`last-up-test-${p.projectid}`]=C,D=E?`${h.testSourceNewFeatureURL}?gzip=1`:`${h.testSourceURL}?gzip=1`,a.remoteDebug){let b=1;'ios'===a.remoteDebugLocal?b=2:'android'===a.remoteDebugLocal&&(b=3);const c=a.remoteProxyPort||0,d=a.disableUrlCheck?1:0;D=`${h.testSourceURL}?gzip=1&open_remote=yes&remote_network_type=${b}&remote_proxy_port=${c}&disable_url_check=${d}`}let{page:b,query:c,searchQuery:d,boxQI:e}=a;if(b){let a=encodeURIComponent(`${b}?${c}`);D=`${D}&path=${a}`}if(d&&(D=`${D}&search_query=${encodeURIComponent(d)}`),e){D=`${D}&search_extInfo=${encodeURIComponent(JSON.stringify({box_qi:e}))}`}}else{l[`last-up-load-${p.projectid}`]=C;let b=encodeURIComponent(a.desc),c=encodeURIComponent(a.version),d=encodeURIComponent(a.uuid);D=E?`${h.commitSourceNewFeatureURL}?user-version=${c}&user-desc=${b}&uuid=${d}&gzip=1`:`${h.commitSourceURL}?user-version=${c}&user-desc=${b}&uuid=${d}&gzip=1`}let F=d.gzipSync(A);const G=1*new Date,H=a.tempProject?{url:`${D}&appid=${a.tempProject.appid}&devplugin=${p.compileType==s.plugin?1:0}`,method:'post',body:F,needToken:1}:{url:`${D}&devplugin=${p.compileType==s.plugin?1:0}`,method:'post',body:F,needToken:1,needAppID:1};a.tempProject&&a.tempProject.attr&&(a.tempProject.attr.platform&&(H.url+='&platform=1'),a.tempProject.attr.platform&&a.tempProject.attr.extInfo&&(H.url+=`&ext_appid=${a.tempProject.attr.extInfo.appid||''}`));let{body:I}=await f(H);const J=1*new Date;return r(a.test?'client_test_source_time':'client_commit_source_time',p.appid,`${J-G}`),w('uploadend','\u4E0A\u4F20\u5B8C\u6210'),I}const b=require('fs'),c=require('path'),d=require('zlib'),e=require('rmdir'),f=require('./15ba1827c7f6564a45df6bd44da3a977.js'),g=require('./92320c1386e6db6a6f2556736a9bc280.js'),h=require('./f171257bbcaef547a3cf27266ccb0db2.js'),i=require('./949d8235c744ced2a80121e4dba34c28.js'),j=require('./911222a6723da8db7ca8a8e3689591e1.js'),k=require('./e5fa35c3c8e81bc6466b4b8eb436113b.js'),l=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),m=require('./1dea83a77e99a7c94f6b6f01f5c175b0.js'),n=require('./common/locales/index.js'),o=require('./3bfffbe88b3d923921f851c0697974fe.js'),p=require('./72653d4b93cdd7443296229431a7aa9a.js'),q=g.Weappdest,r=require('./da7c31daaf542cf1796023d8e344b98a.js'),s=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),t=require('./a932aac82ac84fc9c6c92194bd88204e.js'),u=()=>{};module.exports=async function(b){return t.enqueueBuildTask(a.bind(null,b),t.buildType.upload)}}(require('lazyload'),require);