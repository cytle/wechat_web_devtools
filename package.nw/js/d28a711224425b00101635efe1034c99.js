'use strict';!function(require,directRequire){function a(a,b,c){const d=c||f();if(!1!==y.md5){if(!y.libs[d]||!y.libs[d][a])return void console.warn('no vendor md5 record',d);let c=y.libs[d][a],e=q.createHash('md5');e.update(b);let f=e.digest('hex');if(c!==f){let b=new Error(`${d} ${a} ${f}!=${c}`);throw b.code=n.VENDOR_MD5_NOT_MATCH,b}}}function b(a,b){if(!1!==y.md5){let c=y[a],d=q.createHash('md5');d.update(b);let e=d.digest('hex');if(c!==e){let b=new Error(`${a} ${e}!=${c}`);throw b.code=n.VENDOR_MD5_NOT_MATCH,b}}}function c(){y=D;let a=JSON.stringify(D);j.writeFileSync(w,a),z=y.currentLibVersion,x.emit('VENDOR_VERSION_CHANGE',y)}function d(){try{for(let a in u){let b=k.join(v,a),c=j.readFileSync(k.join(C,a));u[a]?j.writeFileSync(b,c,{mode:511}):j.writeFileSync(b,c)}c()}catch(a){l.error(`copyUnVersionVendor catch error ${a}`)}}async function e(a){let b=A[a];return b?b:(b=A[a]=j.readFileSync(k.join(C,a)),j.writeFile(destFilePath,b,(a)=>{a&&l.error(`getUnVersionVendorCache writeFile error ${a}`)}),b)}function f(){return z}async function g(b,c){const d=c||f();let e=A[d];if(!e)A[d]={};else if(e[b])return e[b];let g,i=k.join(v,d),m=k.join(i,b);try{return g=A[d][b]=j.readFileSync(m),'dev'!=d&&a(b,g,c),g}catch(a){l.error(`getVersionVendorCache catch error ${a}`)}o.sync(i);try{let a=k.join(C,d,b);return g=A[d][b]=j.readFileSync(a,'utf8'),j.writeFile(m,g,(a)=>{a&&l.error(`getVersionVendorCache writeFile ${d}/${b} error ${a}`)}),g}catch(a){l.error(`getVersionVendorCache from install package catch error ${a}`)}let n=`https://dldir1.qq.com/WechatWebDev/vendor/${d}/${b}`;return g=A[d][b]=await h(n),j.writeFile(m,g,(a)=>{l.error(`getVersionVendorCache writeFile ${d}/${b} error ${a}`)}),g}async function h(a){let b=await p({url:a,needToken:-1,needParse:-1});return b.body}function i(a){if(A[a])return A[a];let d=t?a:`${a}.exe`;if(s&&!nw.App.manifest.forceVendor)return A[a]=k.join(C,d),A[a];let e=k.join(v,d);if(j.existsSync(e))try{return b(d,j.readFileSync(e)),A[a]=e,e}catch(a){l.error(`getParsePath catch error ${a}`)}if(e=k.join(C,d),!j.existsSync(e)){let b=new Error(`${a} file not found in install package`);throw b.code='wcc'==a?n.VENDOR_WCC_FILE_NOT_FOUND:n.VENDOR_WCSC_FILE_NOT_FOUND,b}A[a]=e;try{j.writeFileSync(k.join(v,d),j.readFileSync(e),{mode:511}),c()}catch(a){}return e}const j=require('fs'),k=require('path'),l=require('./72653d4b93cdd7443296229431a7aa9a.js'),m=require('./92320c1386e6db6a6f2556736a9bc280.js'),n=require('./949d8235c744ced2a80121e4dba34c28.js'),o=require('mkdir-p'),p=require('./15ba1827c7f6564a45df6bd44da3a977.js'),q=require('crypto'),r=require('events').EventEmitter,s=global.appConfig.isDev,t='darwin'===process.platform;let u=t?{wcc:!0,wcsc:!0,DevToolProtector:!0}:{"wcc.exe":!0,"wcsc.exe":!0};u=Object.assign(u,{"hls.js":!1,"WARemoteDebug.js":!1,"devtools-native-components.js":!1});const v=m.WeappVendor,w=k.join(v,'config.json'),x=new r;let y,z,A={};const B=k.join(__dirname,'../../vendor/dev'),C=s?k.join(__dirname,'../../vendor/'):k.join(__dirname,'./vendor/'),D=JSON.parse(j.readFileSync(k.join(C,'config.json'),'utf8'));(function(){try{if(y=JSON.parse(j.readFileSync(w,'utf8')),y.configVersion>=D.configVersion)return void(z=y.currentLibVersion)}catch(a){l.error(`init catch error ${a}`)}d()})(),module.exports={on:function(a,b){x.on(a,b)},off:function(a,b){x.removeListener(a,b)},getFile:async function(a,b){return b||!s||nw.App.manifest.forceVendor?!b&&u.hasOwnProperty(a)?e(a):g(a,b):j.readFileSync(k.join(B,a),'utf8')},setVersion:function(a){return y.libs[a]?z!=a&&(z=a,x.emit('VENDOR_VERSION_CHANGE',a)):z!=y.currentLibVersion&&(z=y.currentLibVersion,x.emit('VENDOR_VERSION_CHANGE',a)),z},getVersion:function(){return z},getVendorConfig:function(){return y||D},getWXMLParsePath:function(){return i('wcc')},getWXSSParsePath:function(){return i('wcsc')},getFixpreferencesPath:function(){if(!t)return;if(A.DevToolProtector)return A.DevToolProtector;let a='DevToolProtector';if(s)return A.DevToolProtector=k.join(C,a),A.DevToolProtector;let b=k.join(v,a);if(!j.existsSync(b)&&(b=k.join(C,a),!j.existsSync(b))){let a=new Error('DevToolProtector file not found in install package');throw a.code=n.VENDOR_WCC_FILE_NOT_FOUND,a}return A.DevToolProtector=b,b},updateVendorConfig:async function(a){try{if(a=JSON.parse(a.vendor),a.version>y.configVersion){let b=await p({url:a.url,needToken:0}),c=b.body;y.configVersion<c.configVersion&&(y=c,j.writeFileSync(w,JSON.stringify(y)),x.emit('VENDOR_CONFIG_CHANGE',y),l.info(`updateVendorConfig end get new vendorConfig ${JSON.stringify(y)}`))}}catch(a){l.error(`updateVendorConfig catch error ${a}`)}return y}}}(require('lazyload'),require);