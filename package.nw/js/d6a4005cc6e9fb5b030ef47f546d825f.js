'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){function a(...a){return function(){this.enabled&&j[a[0]].apply(this,a.slice(1))}}function b(){const a=n.getState();return a&&a.settings&&a.settings.shortcuts?a.settings.shortcuts:r.settings.shortcuts}function c(a,c){if(c||(c=b()),c[a]){const b=c[a];return{key:b.key?b.key:'',modifiers:b.modifiers?b.modifiers.join('+'):''}}return{}}function d(a){if(s.hasOwnProperty(a)){const b=s[a];return{key:b.key?b.key:'',modifiers:b.modifiers?b.modifiers.join('+')||'':''}}return{}}function e(){const e=b();return[{label:k.config.MENU_TITLE_APP,submenu:[{label:k.config.MENU_SWITCH_ACCOUNT,click:a('switchAccount'),shouldEnabled:'!inLoginWindow'},{type:'separator'},{label:k.config.MENU_ABOUT,click:a('about')},{label:k.config.MENU_CHECK_UPDATE,click:a('checkUpdate')},{label:k.config.MENU_BBS,click:a('BBS')},{label:k.config.MENU_DOC,click:a('Doc')},{type:'separator'},{label:k.config.MENU_INSPECT,submenu:[{label:k.config.MENU_INSPECT_APP,click:a('inspectApp')},{label:k.config.MENU_INSPECT_EDITOR,click:a('inspectEditor'),shouldEnabled:'isMiniProgramDev'}]},{type:'separator'},{label:k.config.MENU_SWITCH_DEV_MODE,submenu:[{type:'checkbox',label:k.config.MENU_WEB_DEV,click:a('switchToWebDev'),shouldEnabled:'isMiniProgramDev'},{type:'checkbox',label:k.config.MENU_MINI_PROGRAM_DEV,click:a('switchToMiniProgramDev'),shouldEnabled:'isWebDev'}],shouldEnabled:'isMiniProgramDev || isWebDev'},_extends({label:k.config.MENU_EXIT},d('exit'),{click:a('exit')})]},{label:k.config.MENU_TITLE_PROJECT,submenu:[_extends({label:k.config.MENU_NEW_PROJECT},d('newProject'),{click:a('newProject'),shouldEnabled:'(inSelectProjectWindow || isMiniProgramDev) && !inLoginWindow'}),{label:k.config.MENU_OPEN_RECENT_PROJECT,submenu:[],shouldEnabled:'isMiniProgramDev && !inLoginWindow'},{type:'separator'},{label:k.config.MENU_NEW_MINI_CODE,click:a('newMiniCode'),shouldEnabled:'isMiniProgramDev && !inLoginWindow'},{label:k.config.MENU_IMPORT_MINI_CODE,click:a('importMiniCode'),shouldEnabled:'isMiniProgramDev && !inLoginWindow'},{type:'separator'},{label:k.config.MENU_PROJECTS,click:a('viewProjects'),shouldEnabled:'isMiniProgramDev && !inLoginWindow'},{type:'separator'},_extends({label:k.config.MENU_CLOSE_PROJECT},d('closeProject'),{click:a('closeProject'),shouldEnabled:'isMiniProgramDev && !inLoginWindow'})]},{label:k.config.MENU_TITLE_TOOLS,submenu:[_extends({label:k.config.MENU_BUILD,shortcutName:'rebuild'},c('rebuild',e),{click:a('rebuild'),shouldEnabled:'isMiniProgramDev && inMainWindow'}),_extends({label:k.config.MENU_REFRESH,shortcutName:'refresh'},c('refresh',e),{click:a('rebuild'),shouldEnabled:'isMiniProgramDev && inMainWindow'}),{label:k.config.MENU_BUILD_SETTINGS,click:a('openBuildSettings'),shouldEnabled:'isMiniProgramDev && inMainWindow',submenu:[{type:'checkbox',label:k.config.MENU_NORMAL_BUILD,checked:!0,click:a('customRebuild',-1)},{type:'separator'},{label:k.config.MENU_NEW_CUSTOM_BUILD}]},{type:'separator'},_extends({label:k.config.MENU_SIMULATOR_TOGGLE_FOREGROUND_BACKGROUND,shortcutName:'toggleForegroundBackgroundStatus'},c('toggleForegroundBackgroundStatus',e),{click:a('toggleForegroundBackgroundStatus'),shouldEnabled:'isMiniProgramDev && inMainWindow'}),{type:'separator'},{label:k.config.MENU_CLEAR_CACHE,shouldEnabled:'isMiniProgramDev && inMainWindow',submenu:[{label:k.config.MENU_CLEAR_FILE_CACHE,click:a('clearFileCache'),shouldEnabled:'isMiniProgramDev && inMainWindow'},{label:k.config.MENU_CLEAR_STORAGE_CACHE,click:a('clearStorageCache'),shouldEnabled:'isMiniProgramDev && inMainWindow'},{label:k.config.MENU_CLEAR_AUTH_CACHE,click:a('clearAuthCache'),shouldEnabled:'isMiniProgramDev && inMainWindow'},{label:k.config.MENU_CLEAR_WEBVIEW_CACHE,click:a('clearWebviewCache'),shouldEnabled:'isMiniProgramDev && inMainWindow'},{label:k.config.MENU_CLEAR_SESSION,click:a('clearSession'),shouldEnabled:'isMiniProgramDev && inMainWindow'},{type:'separator'},{label:k.config.MENU_CLEAR_ALL,click:a('clearAllCache'),shouldEnabled:'isMiniProgramDev && inMainWindow'}]}]},{label:k.config.MENU_TITLE_WINDOW,submenu:(global.online?[{label:k.config.MENU_TOGGLE_LOCK_WINDOW_SIZE,click:a('toggleMiniMode')}]:[]).concat([_extends({type:'checkbox',shortcutName:'toggleToolbar',label:k.config.MENU_TOOLBAR},c('toggleToolbar',e),{click:a('toggleToolbar'),shouldEnabled:'isMiniProgramDev && inMainWindow',shouldChecked:'isToolbarVisible'}),_extends({type:'checkbox',shortcutName:'toggleSimulatorWindow',label:k.config.MENU_SIMULATOR},c('toggleSimulatorWindow',e),{click:a('toggleSimulatorWindow'),shouldEnabled:'isMiniProgramDev && inMainWindow',shouldChecked:'isSimulatorVisible'}),_extends({type:'checkbox',label:k.config.MENU_DEVTOOLS,shortcutName:'toggleDebugWindow'},c('toggleDebugWindow',e),{click:a('toggleDebugWindow'),shouldEnabled:'isMiniProgramDev && inMainWindow',shouldChecked:'isDevtoolsVisible'})])}]}function f(){const a=e(),b=a[0];return a.shift(),a.push(b),a[2].submenu=a[2].submenu.slice(7),a}function g(a,b){for(const c of b)if(c.submenu){const b=new nw.Menu;g(b,c.submenu);const d=new nw.MenuItem({label:c.label,submenu:b});d.enabled=!c.shouldEnabled||l.evaluate(c.shouldEnabled),a.append(d),c.instance=d}else{const b={};for(const a in c)b[a]=c[a];const d=new nw.MenuItem(b);d.enabled=!b.shouldEnabled||l.evaluate(b.shouldEnabled),a.append(d),c.instance=d}}function h(){}const i=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),j=require('./25d0beb4120ce2acafb4e03b95444fda.js'),k=require('./common/locales/index.js'),l=require('./41f4eba9fb17703b7d61eca8b05aa076.js'),m=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),n=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js'),o=require('./72653d4b93cdd7443296229431a7aa9a.js'),p='darwin'===process.platform,q=p?'cmd':'ctrl',r=require('./5498e660c05c574f739a28bd5d202cfa.js'),{preservedShortcuts:s}=require('./f87ad2ec2a5cfdfc5b7856a3adcf63ef.js'),t=require('./9fdd4ac31a05c27355910f0d74accd4c.js'),u=new Map;let v=null;const w=(a)=>a[1].submenu[1].instance,x=(a)=>a[0].submenu[1].instance,y=(a)=>a[2].submenu[2].instance,z=(a)=>a[1].submenu[2].instance,A=(a)=>`${a}`,B=(b,c,d)=>new nw.MenuItem({label:A(c,d),click:a('openProject',b)}),C=(a)=>{a||(a=global.Win);const b=new nw.Menu({type:'menubar'}),c=p?e():f();u.set(a,{menu:b,structure:c}),g(b,c),p&&h(b),a.menu=b},D=(b)=>{const c=n.getState(),d=c.project.current,e=p?y(b):z(b);if(d&&e){const b=e.submenu;let c=d.compileType;c==t.plugin&&(c=t.weapp);const f=d.condiction[c];if(!f)return;const g=f.list;for(;b.items[0];)b.removeAt(0);b.append(new nw.MenuItem({type:'checkbox',label:k.config.MENU_NORMAL_BUILD,checked:-1===f.current,click:a('customRebuild',-1)})),b.append(new nw.MenuItem({type:'separator'}));for(let c=0,d=g.length;c<d;c++){const d=g[c];b.append(new nw.MenuItem({type:'checkbox',label:d.name,checked:f.current==c,click:a('customRebuild',c)}))}0<g.length&&b.append(new nw.MenuItem({type:'separator'})),b.append(new nw.MenuItem({label:k.config.MENU_NEW_CUSTOM_BUILD,click:a('createCustomCompile',d.compileType)}))}};module.exports={set:()=>{},init:C,update:(d)=>{d||(d=global.Win);const e=u.get(d),f=b();let g=!1;if(!e)return;const h=e.menu,i=e.structure,j=(a)=>{for(const b of a){if(b.instance){if(b.shouldEnabled){const a=b.instance.enabled,c=l.evaluate(b.shouldEnabled);a!==c&&(b.instance.enabled=c),f._editingShortcuts&&(b.instance.key||b.instance.modifiers)&&(b.instance.enabled=!1)}if(b.shouldChecked){const a=b.instance.checked,c=l.evaluate(b.shouldChecked);a!==c&&(b.instance.checked=c)}if(b.shortcutName){const a=b.instance.key,d=b.instance.modifiers,{key:e,modifiers:h}=c(b.shortcutName,f);(e!==a||h!==d)&&(g=!0,b.instance.key=e,b.instance.modifiers=h)}}b.submenu&&(b.instance?b.instance.enabled&&j(b.submenu):j(b.submenu))}};j(i);try{const b=p?w(i):x(i);if(b){const c=n.getState(),d=c.project.current;if(d){const e=b.submenu,f=c.project.list,g=m.recentProjects.filter((a)=>a!==d.projectid);for(let b=0,c=g.length;b<c;b++){const c=g[b],d=e.items[b],h=f[c],i=decodeURIComponent(h.projectname);if(!d)e.append(B(h.projectid,i,h.projectpath));else{const b=A(i,h.projectpath);d.label!==b&&(d.label=b,d.click=a('openProject',h.projectid,i))}}}}}catch(a){o.error(`update recent projects menu catch error ${a}`)}try{D(i)}catch(a){o.error(`update compile condiction menu catch error ${a}`)}p||!g||v||(v=setTimeout(()=>{C(global.windowMap.get('MAIN')),v=null},400))}}}(require('lazyload'),require);