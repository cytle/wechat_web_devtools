'use strict';!function(require,directRequire){function a({except:a=[]}={}){let b=j.readdirSync(v);if(0<b.length)for(let c,d=0,e=b.length;d<e;d++){c=!1;for(let e=0,f=a.length;e<f;e++)if(b[d].endsWith&&b[d].endsWith(a[e])){c=!0;break}c||r.rmSync(k.join(v,b[d]))}}async function b(a){D=!0,q({title:`回退版本`,message:`非常抱歉，上次版本更新存在非常大的问题，是否回退版本？`,buttons:[{title:'\u5B89\u88C5'}],callback:(b)=>{if(0===b){let b=w?'open':a,c=w?[a]:[];try{m(b,c,{detached:!0,cwd:v})}catch(b){nw.Shell.openItem(k.join(v,a))}r.quit()}}})}async function c(a,b){D=!0,q({title:`有新版本`,message:`新版本 ${a} 已经准备好，立刻重启安装？`,buttons:[{title:'\u5B89\u88C5\u65B0\u7248\u672C'}],callback:(a)=>{if(0===a){let a=w?'open':b,c=w?[b]:[];try{m(a,c,{detached:!0,cwd:v})}catch(a){nw.Shell.openItem(k.join(v,b))}r.quit()}}}),await A.open(),await A.insert('noticecenter',[{type:t.DBType.tools,title:'\u7248\u672C\u66F4\u65B0',content:`最新的开发工具版本 ${a}`,link:b,timestamp:Date.now()/1e3}]),await A.close()}async function d(b){const{version:c,versionType:d}=b;let e=`${x}_${c}.${w?'ndmg':'nexe'}`,f=k.join(v,e),g=`${x}_${c}.${w?'dmg':'exe'}`,h=k.join(v,g);if(j.existsSync(h))return g;let i='';try{let a=c?c.toString():'';a=a.slice(0,1)+'.'+a.slice(1,3)+'.'+a.slice(3),i=`${x}_${a}.${w?'dmg':'exe'}`}catch(a){}return await a({except:[i]}),new Promise((a,b)=>{let e='',i={url:`${z}&type=${x}&download_version=${c}&version_type=${d}`,followRedirect:function(a){return e=a.caseless.get('md5'),e}};C=!0,o(i,(a)=>{return C=!1,a?b(a):void process.nextTick(()=>{k()})}).pipe(j.createWriteStream(f,{mode:511}));const k=()=>{try{let c=Buffer.from(e,'base64'),d=j.readFileSync(f),i=l.createHash('md5');i.update(d);let k=i.digest('hex');const m=l.createVerify('RSA-SHA1');if(m.update(k),!m.verify(B,c))return b('signature not match');j.rename(f,h,(c)=>{return c?b(c):void a(g)})}catch(a){b(a)}}})}function e(){try{let a=0,b=j.readdirSync(v);if(0<b.length)for(let c,d=0,e=b.length;d<e;d++)if(c=b[d].match(/(\d+)\.(dmg|exe)$/),c&&c[1]){let b=parseInt(c[1]);Number.isInteger(b)&&b>a&&(a=b)}return a}catch(a){return 0}}async function f(a={}){return new Promise((b,c)=>{let d={url:`${n.checkUpdate}?clientversion=${y}&type=${x}`};a.force&&(d.url+='&force=1');let f=e();f&&(d.url+=`&downloadedversion=${f}`),o(d,(a,d,e)=>{if(a)return c(a);try{let a=JSON.parse(e),d=a.baseresponse||{},f=d.errcode;0==f?b({version:a.update_version,forceUpdate:2==a.update_type,versionType:a.version_type}):c(f)}catch(a){c(a)}})})}function g(a){if(a){let b=a.version;if(b>y||a.forceUpdate)return!0}return!1}function h(a){return a+='',a.replace(/^(\d)(\d\d)(\d+)$/,function(a,b,c,d){return`${b}.${c}.${d}`})}async function i(a){try{if(a){let e=a.version,f=h(e),i=e<y&&a.forceUpdate;if(g(a)&&!C){let e=await d(a);D||(i?b():c(f,e)),a.forceUpdate&&(s.forceUpdateVersion=f)}}}catch(a){}}const j=require('fs'),k=require('path'),l=require('crypto'),m=require('child_process').spawn,n=require('./f171257bbcaef547a3cf27266ccb0db2.js'),o=require('./233d77ecf0781f44985f684f70e316d0.js'),p=require('./72653d4b93cdd7443296229431a7aa9a.js'),q=require('./d3ce001ab1e75959382f6a7e0156dd17.js'),r=require('./84b183688a46c9e2626d3e6f83365e13.js'),s=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),t=require('./bcb48ae14d243711d3b31cb0f602d209.js'),u=require('./92320c1386e6db6a6f2556736a9bc280.js'),v=u.WeappApplication,w='darwin'===process.platform,x=w?'darwin':'x64'===process.arch?'x64':'ia32',y=parseInt(global.appVersion.replace(/\./g,'')),z=`${n.downloadRedirectURL}?os=${w?'darwin':'win'}`,A=require('./4102b43ad51182743111f5d5e1fc5b46.js'),B=`-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCZm2cFP/uF81V5KH/B9dn/g7WA
CM3yu0P7n9sm/O6c58HTYI0+xugCfwMuoX7hyU4jkWbZ/BYK7IgWhmVfiRtgomJe
wuZlxfGUpmrr1PA2KbYVpPW0V6e/2uZu1Ev3xU7PkHKYf4AKgPO8w98hvKlUJRbk
H4AYMxX6eL9j9qCBGQIDAQAB
-----END PUBLIC KEY-----`;var C=!1,D=!1;module.exports={loop:function(){f().then((a)=>{i(a)}).catch(()=>{}),setInterval(()=>{f().then((a)=>{i(a)}).catch(()=>{})},600000)},checkNeedUpdate:async function(){try{let a=await f({force:!0});if(i(a),g(a))return h(a.version)}catch(a){}},resetAlreadyNotify:function(){D=!1}}}(require('lazyload'),require);