"use strict";function init(){var e=require("../../../lib/react.js"),t=require("../../../cssStr/cssStr.js"),s=(require("../../../lib/react-dom.js"),require("../../../stores/webviewStores.js")),a=require("../../../actions/windowActions.js"),i=require("../../../common/actions/actions.js"),o=function(e){a.showTipsMsg({type:"error",msg:e})},c=e.createClass({displayName:"SettingDialog",getInitialState:function(){return{lazyLoaded:!1,show:!1}},componentDidMount:function(){s.on("SEND_AS_SDK",this._handleAssdkCommand)},componentWillUnmount:function(){s.removeListener("SEND_AS_SDK",this._handleAssdkCommand)},_handleAssdkCommand:function(e,t,s){var a=this;t.args;"openSetting"===e?(this.callback=s,i.getAuthList(this.props.project,function(e,t){null!==e?o("获取权限列表失败！"+e):a.setState({lazyLoaded:!0,show:!0,scopeList:t||[]})})):"getSetting"===e&&(this.callback=s,i.getAuthList(this.props.project,function(e,t){if(null!==e)s({errMsg:"getSetting:fail "+e});else{var a=[];t.forEach(function(e){a.push({state:e.state,scope:e.scope,desc:e.scope_desc})}),s({errMsg:"getSetting:ok",authSetting:a})}}))},setAuthList:function(){var e=this;if(this.state.scopeList&&this.state.scopeList.length>0){var t=[];this.state.scopeList.forEach(function(e){t.push({scope:e.scope,state:e.state})}),i.setAuth(this.props.project,t,function(t){return null!==t?void o("设置权限列表失败！"+t):void e.close()})}else this.close()},close:function(){if(this.callback){var e=[];this.state.scopeList.forEach(function(t){e.push({state:t.state,scope:t.scope,desc:t.scope_desc})}),this.callback({errMsg:"openSetting:ok",authSetting:e}),this.callback=null}this.setState({show:!1})},_checkboxChange:function(e){var t=this,s=this.state.scopeList;return function(){s[e].state=1==s[e].state?2:1,t.setState({scopeList:s})}},render:function(){if(!this.state.lazyLoaded)return null;var s=this.props.project,a=s.app_nickname;s.ext_appid&&(a=s.extAppInfo&&s.extAppInfo.app_nickname||s.app_nickname),a=decodeURIComponent(a);for(var i=this.state.scopeList,o=[],c=0;c<i.length;++c){var n=i[c],r="authorize_checkbox"+c,l=1==n.state;o.push(e.createElement("li",{key:n.scope},e.createElement("label",{className:"simulator-authorize-dialog-checkbox",htmlFor:r},e.createElement("input",{id:r,type:"checkbox",checked:l,onChange:this._checkboxChange(c)}),e.createElement("i",null)),e.createElement("span",{onClick:this._checkboxChange(c)},n.scope_desc)))}return e.createElement("div",{style:this.state.show?{}:t.displayNone,className:"simulator-authorize-dialog-wrapper"},e.createElement("div",{className:"simulator-authorize-dialog-mask"}),e.createElement("div",{className:"simulator-authorize-dialog"},e.createElement("div",{className:"simulator-authorize-dialog-hd"},e.createElement("h3",{className:"simulator-authorize-dialog-title"},"授权管理")),e.createElement("div",{className:"simulator-authorize-dialog-bd"},e.createElement("p",{className:"simulator-authorize-dialog-tips"}," 允许",a,"使用以下权限："),e.createElement("ul",{className:"simulator-authorize-dialog-list"},o)),e.createElement("div",{className:"simulator-authorize-dialog-ft"},e.createElement("a",{href:"javascript:;",onClick:this.setAuthList},"确定"))))}});_exports=c}var _exports;init(),module.exports=_exports;