'use strict';var _exports;function init(){const a=require('../log/log.js'),b=require('../../utils/file.js'),c=require('../../stores/projectStores.js'),d=require('../../actions/webviewActions.js'),f=require('fs'),g={audio:!0},h={mimeType:'audio/webm'};var i,j,k,l,m;_exports={startRecord:function(o,p){navigator.mediaDevices.getUserMedia(g).then(q=>{i=q,j=[];try{k=new MediaRecorder(i,h)}catch(r){return a.error('voiceSdk.js Exception while creating MediaRecorder: '+r),void p({errMsg:`startRecord:fail ${JSON.stringify(r)}`})}k.onstop=()=>{let r=c.getCurrentProject(),t=new Blob(j,{type:'audio/webm'}),u=new FileReader;u.addEventListener('loadend',()=>{let v=b.copyFileDataToTemp(u.result,r.hash,'.silk');p({errMsg:'startRecord:ok',tempFilePath:v}),k=void 0}),u.readAsDataURL(t),d.toggleRecordWording(!1)},k.ondataavailable=r=>{r.data&&0<r.data.size&&j.push(r.data)},clearTimeout(l),l=setTimeout(()=>{k&&k.stop()},60000),k.start(10),d.toggleRecordWording(!0)}).catch(q=>{p({errMsg:`startRecord:fail 未找到或者无权限调用录音设备`})})},stopRecord:function(o,p){clearTimeout(l),k&&k.stop(),p({errMsg:'stopRecord:ok'})},playVoice:function(o,p){let q=o.args,r=q.filePath,t=b.getRealPath(r);if(m&&m.dataset.filePath!==r)m.remove();else if(m&&m.dataset.filePath===r)return void m.play();m=document.createElement('audio'),document.body.appendChild(m),f.readFile(t,'utf8',(u,v)=>{u?p({errMsg:`playVoice:fail read ${r} error`}):(m.src=v,m.play(),m.dataset.filePath=r,p({errMsg:'playVoice:ok'}))})},pauseVoice:function(o,p){m&&m.pause(),p({errMsg:'pauseVoice:ok'})},stopVoice:function(o,p){m&&m.remove(),m=void 0,p({errMsg:'pauseVoice:ok'})}}}init(),module.exports=_exports;