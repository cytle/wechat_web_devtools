"use strict";function init(){function e(e,a){var t=y.getUserInfo(),r=t?t.openid:"guest";return u.join(m,e+"_"+a+"_"+r+".data.json")}function a(a,t,r){var o=e(a,t);d.writeFileSync(o,JSON.stringify(r),"utf8"),l.upASData(a,r)}function t(t,r){var o=e(t,r),n=void 0;try{n=JSON.parse(d.readFileSync(o,"utf8"))}catch(e){n={},a(t,r,n)}return n}function r(e,a,r){var o=e.appid,n=e.appname,i=t(o,n),g=r?"getStorageSync":"getStorage",s=e.args,p=s.key,S=i[p],c=void 0;c=void 0!==S?{errMsg:g+":ok",data:S.data,dataType:S.dataType}:{errMsg:g+":fail data not found"},a(c)}function o(e,r,o){var n=e.appid,i=e.appname,g=t(n,i),s=o?"setStorageSync":"setStorage",p=e.args,S=p.key,c=p.data,f=p.dataType;g[S]={data:c,dataType:f};var d=v.getProjectConfig({hash:e.apphash}),u=d?d.Setting.MaxLocalstorageSize:k;JSON.stringify(g).length>1024*u*1024?r({errMsg:s+":fail exceed storage max size "+u+"Mb;"},{appid:n,storage:t(n,i)}):(a(n,i,g),r({errMsg:s+":ok"},{appid:n,storage:g}))}function n(e,t,r){var o=e.appid,i=e.appname;a(o,i,{}),t({errMsg:r?"clearStorageSync:ok":"clearStorage:ok"},{appid:n,storage:{}})}function i(e,r,o){var n=e.appid,i=e.appname,g=t(n,i),s=e.args,p=s.key;delete g[p],a(n,i,g),r({errMsg:o?"removeStorageSync:ok":"removeStorage:ok"},{appid:n,storage:g})}function g(e,a,r){var o=e.appid,n=e.appname,i=t(o,n),g={};g.keys=Object.keys(i),g.currentSize=Math.ceil(JSON.stringify(i).length/1024);var s=v.getProjectConfig({hash:e.apphash}),p=s?s.Setting.MaxLocalstorageSize:k;g.limitSize=1024*p,g.errMsg=r?"getStorageInfoSync:ok":"getStorageInfo:ok",a(g,{appid:o,storage:i})}function s(e,a){g(e,a,!0)}function p(e,a){i(e,a,!0)}function S(e,a){n(e,a,!0)}function c(e,a){r(e,a,!0)}function f(e,a){o(e,a,!0)}var d=require("fs"),u=require("path"),y=require("../../stores/windowStores.js"),v=require("../../stores/projectStores.js"),l=require("../../actions/webviewActions.js"),h=require("../../config/dirConfig.js"),k=10,m=h.WeappStorage;_exports={getStorage:r,clearStorage:n,setStorage:o,removeStorage:i,getStorageInfo:g,getStorageSync:c,setStorageSync:f,clearStorageSync:S,removeStorageSync:p,getStorageInfoSync:s}}var _exports;init(),module.exports=_exports;