"use strict";function init(){var t=require("../actions/windowActions.js"),e=require("../config/messageConfig.js"),i=require("../common/actions/actions.js"),n=2592e6,o=!1,r=!1,s=require("../stores/windowStores.js"),c=function(e){e>0&&t.toggleNewFeatureCheckShowStatus(!0)},a=function(t,e){0===e&&nw.Shell.openExternal(t)},f=function(t,e){e>0&&i.jumpBbs(t)};_exports={checkCouldNotify:function(t){var e={};try{e=JSON.parse(localStorage.getItem("notice_show_info"))||{}}catch(t){log.error("notifications.js checkCouldNotify notice_show_info from localStorage JSON.parse error"),localStorage.setItem("notice_show_info","{}")}var i={},o=Date.now();for(var r in e)o-e[r]<n&&(i[r]=e[r]);return i[t.seq]=o,localStorage.setItem("notice_show_info",JSON.stringify(i)),!e[t.seq]},handleCmdTips:function(t){var i={};if(i=s.getSettingByKey("notify"),this.checkCouldNotify(t)){var n=JSON.parse(t.content),o={title:n.title||"",message:n.content||"",priority:2,requireInteraction:!0},r=function(){};switch(n.tips_type){case e.CmdTipsType.showNewFeature:o.buttons=[{title:n.cancelText||"取消"},{title:n.confirmText||"前往设置"}],r=c;break;case e.CmdTipsType.visitBBS:if(!i.bbs)return;o.buttons=[{title:n.cancelText||"取消"},{title:n.confirmText||"查看详情"}],r=f.bind(this,n.link)}this.notifications(o,r)}},handleSyncMessage:function(t){if(this.checkCouldNotify(t)){var i={};if(i=s.getSettingByKey("notify"),!i.sys)return;var n=JSON.parse(t.content),o={title:n.title||"",message:n.content||""},r=function(){};switch(n.tips_type){case e.TipsType.toast:o.priority=1,o.requireInteraction=!1;break;case e.TipsType.info:o.priority=2,o.requireInteraction=!0;break;case e.TipsType.link:o.priority=2,o.requireInteraction=!0,o.buttons=[{title:n.confirmText||"查看详情"},{title:n.cancelText||"取消"}],r=a.bind(this,n.link)}this.notifications(o,r)}},notifications:function(t,e){if(!r){var i=(+new Date).toString();e=e||function(){};var n={type:"basic",iconUrl:"app/images/logo.png",priority:2,requireInteraction:!0};return t=Object.assign(n,t),o||(o={},chrome.notifications.onButtonClicked.addListener(function(t,e){o[t]&&(o[t](e),chrome.notifications.clear(t))}),chrome.notifications.onClosed.addListener(function(t,e){r=!1})),o[i]=e,chrome.notifications.create(i,t),r=!0,i}}}}var _exports;init(),module.exports=_exports;